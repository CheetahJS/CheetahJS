"use strict";var ch=new function(){function t(n,t,i){return n.replace("{"+i+"}",t)}var n=function(n){Cheetah&&Cheetah.Logger?Cheetah.Logger.Error(n):console.error(n)};this.GetBindData=function(n,t){var u,i,r;if(typeof n!="string")return n;for(u=n.split("."),i=0;i<u.length;++i)r=u[i],t=r.indexOf("[")==0?t[Number(r.substr(1))]:t[r];return t};this.UrlRoot=function(n){var t,i,r;return(n||(n=document.location.toString()),t=n.indexOf("://localhost/"),t!=-1)?(i=n.indexOf("/",t+13),i==-1)?n+"/":n.substring(0,i)+"/":(r=n.indexOf("/",n.indexOf("://")+3),r==-1)?n+"/":n.substring(0,r)+"/"};this.GetModelValue=function(t,i,r){var e=i,o,s,f,h,c,u;if(typeof i=="string"&&(e=i.split(".")),o=e.length,o==0)return t;if(s=e[0],s.indexOf("$")==0&&s.indexOf("$$")==-1)return r?(f=r.GetVar(s.substr(1)),!f)?(n("Variable container does not contain variable in expression."),null):(s=="$bind"&&typeof f=="string"&&(f=t[f]),o==1)?f:this.GetModelValue(f,e.slice(1)):(n("Found variable in expression but no variable container was passed."),null);for(--o,h=0;h<o;++h){if(u=e[h],u=="$$root"&&h==0){for(c=0;t.$$parent;)if(t=t.$$parent,++c==1e3){n("Infinite recursion in model");break}}else if(u.indexOf("[")==0)t=t[Number(u.substr(1))];else if(u=="$$parent"){if(!t.$$parent)return n("$$parent is not valid"),null;t=t.$$parent}else t=t[u];if(!t)return t}return(u=e[o],u.indexOf("[")==0)?t?t[Number(u.substr(1))]:t:t?t[u]:t};this.SetModelValue=function(t,i,r){var e=i,o,f,u,s;for(typeof i=="string"&&(e=i.split(".")),o=e.length-1,f=0;f<o;++f)if(u=e[f],u=="$$root"&&f==0){for(s=0;t.$$parent;)if(t=t.$$parent,++s==1e3){n("Infinite recursion in model");break}}else if(u=="$$parent"){if(!ch.IsValid(t.$$parent)){n("$$parent is not valid");return}t=t.$$parent}else t[u]||(t[u]={}),t=t[u];t[e[o]]=r};this.ElementData=function(n,t){return n?(n.delegateTarget!=undefined&&(n=n.delegateTarget),t==undefined)?$(n).data():$(n).data(t):null};this.EventTarget=function(n){return n?n.delegateTarget?n.delegateTarget:n.target:null};this.SelectTarget=function(n,t){var i=ch.EventTarget(n),r;if(!ch.IsEmpty(t)){for(r=!1;t.length>0;){if(t.indexOf("$self")==0&&(r=!0,t=t.substr(5),t.indexOf(".")==0&&(t=t.substr(1))),t.indexOf("$parent")==0){r=!0;t=t.substr(7);i=i.parentElement;t.indexOf(".")==0&&(t=t.substr(1));continue}break}return r?ch.IsEmpty(t)?$(i):$(i).find(t):$(t)}return $(i)};this.IsValid=function(n){return n!=undefined&&n!=null};this.CopyAttributes=function(n,t){t.ForEach(function(t){n.setAttribute(t.Name,t.Value)})};this.Evaluate=function(n,t,i){return typeof n=="string"?n:n.Evaluate?n.Evaluate(t,i):n};this.Format=function(){var r=Array.prototype.slice.apply(arguments),u=r.length,i,n;if(u==0)return"";if(i=r[0],u>1)for(n=1;n<u;++n)i=t(i,r[n],n-1);return i};this.IsEmpty=function(n){return ch.IsValid(n)?typeof n=="string"?$.trim(n).length==0:n.length!=undefined?n.length==0:!1:!0};this.IsValidNumber=function(n){return ch.IsValid(n)&&!isNaN(n)};this.Sanitize=function(n,t){if(!n||typeof n!="object")return n;if(n.length!=undefined){n.ForEach(function(n){ch.Sanitize(n)});return}for(var i in n)i.indexOf("$$")==0?delete n[i]:t||this.Sanitize(n[i]);return n};this.Merge=function(n,t){for(var i in t)n[i]=ch.Clone(t[i]);return n};this.Clone=function(n,t,i){var u,f,r;if(!n||typeof n!="object")return n;if(t==undefined&&(t=!1),n instanceof Date)return i?n.toJSON():t?n:new Date(n.getTime());if(Array.isArray(n)){for(u=[],r=0;r<n.length;++r)u[r]=t?n[r]:ch.Clone(n[r]);return u}f={};for(r in n)r.indexOf("$$")==-1&&(f[r]=t?n[r]:ch.Clone(n[r]));return f};this.ShallowClone=function(n){return this.Clone(n,!0)};this.Convert=function(n,t){var r,i;return!n||n instanceof Date?n:typeof n!="string"||n.length==0?n:t=="date"?new Date(n):(n=$.trim(n),r=n.toLowerCase(),r=="true")?!0:r=="false"?!1:(i=parseFloat(n),!isNaN(i)&&String(i)==n)?i:(n.indexOf('"')==0&&n.lastIndexOf('"')==n.length-1?n=n.substr(1,n.length-2):n.indexOf("'")==0&&n.lastIndexOf("'")==n.length-1&&(n=n.substr(1,n.length-2)),n)};this.IsNonZero=function(n){return ch.IsValidNumber(n)&&n!=0};this.IsZero=function(n){return!ch.IsValidNumber(n)||n==0};this.Coalesce=function(n,t,i,r){return ch.IsValid(n)?n:ch.IsValid(t)?t:ch.IsValid(i)?i:r};this.Redirect=function(n){document.location.href=n};this.GetValue=function(n){var t=n.localName;return t=="select"?n.options[n.selectedIndex].value:n.value};this.SetValue=function(n,t){var r,i,u;if(n.localName=="select"){for(r=n.options.length,i=0;i<r;++i)if(u=n.options[i].value,t==u){n.selectedIndex=i;break}}else n.value=t};this.Do=function(n){n&&n()};this.AttributeValue=function(t,i,r){var u,f;if(!t)return null;if(t.attributes){if(u=t.attributes[i],r&&(!u||ch.IsEmpty(u.value)))return n("Missing '"+i+"' attribute for '"+t.localName+"' element"),null;if(u)return $.trim(u.value)}else if(t.length!=undefined&&!t.nodeName&&(f=t.FindMatching(function(n){return n.Name==i}),f))return $.trim(f.Value);return null};this.NormalizeText=function(n){return ch.IsValid(n)?n:""};this.FindValue=function(n,t,i){var r=n.FindMatching(function(n){return n.localName==t});return r==null?i!=undefined?i:"":r.value};this.Sort=function(n,t){function f(n){var i,t;for(this.Attr="",this.Asc=!0,this.Num=!1,i=$.trim(n).replaceAll("  "," ").split(" "),this.Attr=i[0],t=1;t<=2;++t)if(i.length>t)i[t]=="desc"?this.Asc=!1:i[t]=="number"&&(this.Num=!0);else break;this.Run=function(n,t){var i=n[this.Attr],r=t[this.Attr],u=this.Asc?-1:1,f=this.Asc?1:-1;return!ch.IsValid(i)&&!ch.IsValid(r)?0:ch.IsValid(i)?ch.IsValid(r)?(this.Num&&(i=Number(i),r=Number(r)),i==r)?0:i<r?u:f:f:u}}var i=t.split(","),u=i.length,r=[];i.ForEach(function(n){r.push(new f(n))});n.sort(function(n,t){for(var f,i=0;i<u;++i)if(f=r[i].Run(n,t),f!=0)return f;return 0})}},Cheetah;!function(){function t(n){return n?n instanceof Date?n:(n=new Date(n),isNaN(n.getTime()))?null:n:n}function i(n,t,i){var u,r,f;for(i==undefined&&(i=!1),u=n.length,r=0;r<u;++r)if(f=t(n[r]),i&&!f)break;return u>0}function r(n,t){for(var u=n.length,r=0,i=0;i<u;++i)t(n[i])&&++r;return r}function n(n,t){for(var i,u=n.length,r=0;r<u;++r)if(i=n[r],t(i))return typeof i=="object"&&(i.$matchingIndex=r),i;return null}NodeList.prototype.ForEach=function(n,t){return i(this,n,t)};NamedNodeMap.prototype.ForEach=function(n,t){return i(this,n,t)};Array.prototype.ForEach=function(n,t){return i(this,n,t)};Array.prototype.OrderBy=function(n,t,i){if(n){typeof n!="string"&&i==undefined&&(i=t,t=n,n=null);var r=t==undefined||t?1:-1;this.sort(function(t,u){var f=ch.Convert(n?t[n]:t,i),e=ch.Convert(n?u[n]:u,i);return f==e?0:f>=e?r:-r})}return this};Array.prototype.ToDictionary=function(n){var t={};return this.ForEach(function(i){var r=n?n(i):i;t[r]=i}),t};Array.prototype.Reduce=function(n,t){for(var i=t,u=this.length,r=0;r<u;++r)i=n(i,this[r]);return i};Array.prototype.Sum=function(n){return this.length==0?0:this.Reduce(function(t,i){var r=Number(n?n(i):i);return ch.IsValidNumber(r)?t+r:t},0)};Array.prototype.Min=function(n){if(this.length==0)return undefined;var t=undefined;return this.ForEach(function(i){var r=n?n(i):Number(i);r&&(t=t==undefined?r:Math.min(t,r))}),t};Array.prototype.Max=function(n){if(this.length==0)return undefined;var t=undefined;return this.ForEach(function(i){var r=n?n(i):Number(i);r&&(t=t==undefined?r:Math.max(t,r))}),t};Array.prototype.Mean=function(n){if(this.length==0)return undefined;var t=undefined,i=undefined;return this.ForEach(function(r){var u=n?n(r):Number(r);u&&(t=t?Math.max(t,u):u,i=i?Math.min(i,u):u)}),(t+i)/2};Array.prototype.Average=function(n){var t=this.Sum(n);return t/this.length};Array.prototype.PercentageOfTotal=function(n,t){if(!n)return 0;var i=this.Sum(t);return i?n/i*100:0};Array.prototype.MinDate=function(n){if(this.length==0)return undefined;var i=undefined;return this.ForEach(function(r){var u=t(n?n(r):r);u&&(i=i?i<u?i:u:u)}),i};Array.prototype.MaxDate=function(n){if(this.length==0)return undefined;var i=undefined;return this.ForEach(function(r){var u=t(n?n(r):r);u&&(i=i?i>u?i:u:u)}),i};Array.prototype.MeanDate=function(n){if(this.length==0)return undefined;var i=undefined,r=undefined;return this.ForEach(function(u){var f=t(n?n(u):u);f&&(i=i?i>f?i:f:f,r=r?r<f?r:f:f)}),new Date((i.getTime()+r.getTime())/2)};Array.prototype.Update=function(n){return this.ForEach(n),this};Array.prototype.ShallowCopy=function(){for(var t=[],i=this.length,n=0;n<i;++n)t.push(this[n]);return t};Array.prototype.peek=function(){return this.length==0?null:this[this.length-1]};Array.prototype.Pack=function(n,t){return ch.IsValid(t)?this.Reduce(function(i,r){var u=t?t(r):r;return i==""?u:i+n+u},""):this.join(n)};Array.prototype.Append=function(n){for(var i=n.length,t=0;t<i;++t)this.push(n[t]);return this};Array.prototype.FindMatching=function(t){return n(this,t)};Array.prototype.CountWhere=function(n){return r(this,n)};NodeList.prototype.CountWhere=function(n){return r(this,n)};NodeList.prototype.Where=function(n){for(var i,u=this.length,r=[],t=0;t<u;++t)i=this[t],n(i)&&r.push(i);return r};Array.prototype.Clear=function(){return this.splice(0,this.length),this};Array.prototype.Where=function(n,t){var f,i,r,u;for(t==undefined&&(t=!1),f=this.length,i=[],r=0;r<f;++r)u=this[r],n(u)&&(t?i.push(ch.Clone(u)):i.push(u));return i.$$parent=this.$$parent,i};Array.prototype.First=function(n,t){var i,f,r,u;if(ch.IsValidNumber(n)||(n=1),i=[],n>=this.length)i=this;else{for(t==undefined&&(t=!1),f=Math.min(this.length,n),r=0;r<f;++r)u=this[r],t?i.push(ch.Clone(u)):i.push(u);i.$$parent=this.$$parent}return i.length==1&&n==1?i[0]:i};Array.prototype.Remove=function(n){for(var t=this.length-1;t>=0;--t)n(this[t])&&this.splice(t,1);return this};Array.prototype.Add=function(n,t){return(t||t==undefined)&&(n=ch.Clone(n)),this.push(n),this};NodeList.prototype.FindMatching=function(t){return n(this,t)};NamedNodeMap.prototype.FindMatching=function(t){return n(this,t)};Array.prototype.IfAny=function(t){return n(this,t)!=null};Array.prototype.Contains=function(t){return n(this,t)!=null};Array.prototype.IfNotAny=function(n){for(var i=this.length,t=0;t<i;++t)if(!n(this[t]))return!0;return!1};Array.prototype.IfAll=function(n){return!this.IfNotAny(n)};String.prototype.FirstInList=function(n){return!n||this.indexOf(n)==-1?this:this.substr(0,this.indexOf(n))};String.prototype.Contains=function(n,t){return n?t?this.indexOf(n)!=-1:this.toLowerCase().indexOf(n.toLowerCase())!=-1:!1};String.prototype.NthInList=function(n,t){if(n==0)return this.FirstInList(t);var i=this.split(t);return i[n]};String.prototype.EndsWith=function(n){if(n==undefined||n==null||this==undefined||this==null)return!1;var t=this.length,i=n.length;return t<i?!1:this.lastIndexOf(n)==t-i};String.prototype.EnsureEndsWith=function(n){return this.EndsWith(n)?this:this+n};String.prototype.replaceAll=function(n,t){return this.replace(new RegExp(n.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),t)};String.prototype.StripAfter=function(n){var t=this.indexOf(n);return t!=-1?this.substr(0,t+n.length):this};String.prototype.StripBefore=function(n){var t=this.indexOf(n);return t!=-1?this.substr(t):this};String.prototype.TrimBefore=function(n){var t=this.indexOf(n);return t>0?this.substr(t):this};String.prototype.TrimBeforeIncluding=function(n){var t=this.indexOf(n);return t>0?this.substr(t+n.length):this};String.prototype.TrimAfter=function(n){var t=this.indexOf(n);return t>=0?this.substr(0,t+n.length):this};String.prototype.TrimAfterIncluding=function(n){var t=this.indexOf(n);return t>=0?this.substr(0,t):this};Number.prototype.PadLeft=function(n,t){var i=String(this);for(t||(t="0");i.length<n;)i=t+i;return i};Date.prototype.DateOnly=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())};Date.prototype.AddDays=function(n){var t=new Date(this.getTime());return t.setDate(t.getDate()+n),t};Date.prototype.AddHours=function(n){var t=new Date(this.getTime());return t.setHours(t.getHours()+n),t};Date.prototype.AddMinutes=function(n){var t=new Date(this.getTime());return t.setMinutes(t.getMinutes()+n),t};Date.prototype.WithinRange=function(n,t){var i=this.DateOnly();return i<n.DateOnly()?!1:i>t.DateOnly().AddDays(1)?!1:!0};Function.prototype.inherits=function(n){return n.constructor==Function?(this.prototype=new n,this.prototype.constructor=this,this.prototype.parent=n.prototype):(this.prototype=n,this.prototype.constructor=this,this.prototype.parent=n),this}}();Cheetah=Cheetah||{};Cheetah.StartDelimiter="//";Cheetah.EndDelimiter="//";Cheetah.Builder=null;Cheetah.Logger=null;!function(n,t){function o(n,t,i){return n.EvaluateText(n.ViewModel,ch.AttributeValue(t,i))}function u(n,t){var i=ch.AttributeValue(t,"if");return ch.IsEmpty(i)?null:n.CreateCondition(i)}function r(n,t,i){if(n==null)return!0;var r=ch.Coalesce(t.$model,i.Model);return n.Eval(i,r)}function s(n,t){var u,i,r;if(!n.$$parent||!n.$$id||!n.$$path||t&&(t.length!=n.length||t.$$id!=n.$$id||t.$$path!=n.$$path))return!0;for(u=n.length,i=u-1;i>=0;--i)if((r=n[i],!r.$$parent||!r.$$id)||r.$$index!=i)return!0;return!1}function f(n,t){var i=ch.ShallowClone(n);return h(i,t?t:n),i}function h(n,t){if(Array.isArray(n)){var i=0;n.ForEach(function(t){t.$$parent=n;t.$$index=i++})}t&&c(n,t)}function c(n,t){n.$$id=t.$$id;n.$$index=t.$$index;n.$$parent=t.$$parent;n.$$path=t.$$path}function l(t){n.Transform.call(this);this.Name=t;this.NewName=t;this.IsEditable=t=="input"||t=="select"||t=="textarea";this.IsIdentity=!0;this.IgnoreText=!1}var i={Templates:{},Actions:{},Prerequisites:[],Transforms:{},ActionSteps:{},Priority:{Default:0,High:100}},e;n.ViewModel=function(t){this.Model=null;this.ModelPath="";this.ModelVerb="GET";this.Template="";var r=new i.ViewModel(this,t);this.LoadRouteTable=function(n,t,i){r.LoadRouteTable(n,t,i)};this.HaveRoutes=function(){return!ch.IsEmpty(r.Routes)};this.LoadModel=function(n,t){r.LoadModel(n,t)};this.GetModel=function(n,t){r.GetModel(n,t)};this.ProcessModel=function(n,t){r.ProcessModel(n,t)};this.PreProcessModel=function(){};this.PostProcessModel=function(){};this.Sync=function(n,t){r.Sync(n,t)};this.OnError=function(n){alert(n)};this.OnInfo=function(n){alert(n)};this.Confirm=function(n,t){confirm(n)&&t()};this.CreateService=function(){return new n.Service("")};this.UpdateView=function(){r.UpdateView()}};n.RegisterTransform=function(t){ch.IsEmpty(t.Name)?n.Logger.Error("Transform missing name"):ch.IsEmpty(t.NewName)&&ch.IsEmpty(t.UseTemplate)&&ch.IsEmpty(t.RequiredParent)?n.Logger.Error("Transform missing new name"):i.Transforms[t.Name]?n.Logger.Error("A transform with the name of '"+t.Name+"' has already been registered"):i.Transforms[t.Name]=t};n.RegisterActionStep=function(t){ch.IsEmpty(t.Name)?n.Logger.Error("Custom action step missing name"):t.Run?i.ActionSteps[t.Name]?n.Logger.Warning("A custom action step with the name of '"+t.Name+"' has already been registered"):i.ActionSteps[t.Name.toLowerCase()]=t:n.Logger.Error("Custom action step missing Run method")};n.RegisterPrerequisite=function(n){i.Prerequisites.push(n)};!function(t){function i(){var n=ch.ShallowClone(t.Prerequisites);return n.IfAll(function(n){return n.IsMet})}t.ViewModel=function(i,r){this.Conditions={};this.Expressions={};this.Routes=null;this.FirstSubRoute=null;this.Synced=[];this.ActualViewModel=i;this.Container=r;this.Deferred=[];this.Async=[];this.Watchers=new t.WatcherList(this);this.TemplateNode=null;this.ModelID=1;this.Updated=!1;this.SuppressUpdate=!1;var u=this.GetContainer();u&&(this.ActualViewModel.Template=n.Builder.InnerHTML(u),this.ActualViewModel.ModelPath=n.Builder.GetAttribute(u,"ch-model",!0))};t.ViewModel.prototype.FixModel=function(n){if(!n.$$id){if(n.$$parent&&n.$$path){var t=this.FixModel(n.$$parent);n=ch.GetModelValue(t,n.$$path)}n.$$id||(n.$$Id=this.ModelID++)}return n};t.ViewModel.prototype.GetContainer=function(){return this.Container=="body"?n.Builder.FirstElementByName("body"):n.Builder.FindElement(this.Container)};t.ViewModel.prototype.LoadModel=function(n,t){if(!ch.IsEmpty(this.ActualViewModel.ModelPath)){var i=this;this.GetModel(n,function(n){i.ProcessModel(n,t)})}};t.ViewModel.prototype.GetModel=function(n,t){var i=this;this.CreateService().LoadModel(this.ActualViewModel.ModelPath,this.ActualViewModel.ModelVerb,n,t,function(n){i.OnError(n)})};t.ViewModel.prototype.ProcessModel=function(n,t){this.ActualViewModel.Model=n;this.PreProcessModel();n=this.ActualViewModel.Model;this.ReallyProcessModel(n,t)};t.ViewModel.prototype.ReallyProcessModel=function(r,u){var s,f,e,o;if(!i()){s=this;setTimeout(function(){s.ReallyProcessModel(r,u)},10);return}this.ModelID=1;f=this.GetContainer();f!=null&&(e=f.style.display,n.Builder.ShowElement(f,!1),n.Builder.InnerHTML(f,""),o=this.CreateTempNode(),n.Builder.InnerHTML(o,this.ActualViewModel.Template),this.Watchers=new t.WatcherList(this),this.Deferred=[],this.Async=[],this.RenderModel(o,f,this.ActualViewModel.Model),n.Builder.RemoveFromParent(o),f.style.display=e=="none"||e==""?"block":e,this.TemplateNode&&n.Builder.RemoveFromParent(this.TemplateNode),this.ProcessDeferred(),this.ProcessAsync(r,u))};t.ViewModel.prototype.CreateTempNode=function(){var t=n.Builder.AppendChild(n.Builder.FirstElementByName("body"),"div");return n.Builder.ShowElement(t,!1),t};t.ViewModel.prototype.CreateTemplate=function(t){this.TemplateNode||(this.TemplateNode=this.CreateTempNode());var i=n.Builder.AppendChild(this.TemplateNode,"div");return n.Builder.InnerHTML(i,t),i};t.ViewModel.prototype.ProcessDeferred=function(){this.Deferred.ForEach(function(n){ch.Do(n)});this.Deferred=[]};t.ViewModel.prototype.ProcessAsync=function(n,t){if(ch.IsEmpty(this.Async))this.PostProcessModel(n),t&&t(n);else{var i=this;setTimeout(function(){i.Async.ForEach(function(n){ch.Do(n)});i.Async=[];i.ProcessAsync(n,t)},20)}};t.ViewModel.prototype.RenderModel=function(n,i,r){r.$$parent=null;var u=new t.DOMElement(this,null,n,r);u.NewElement=i;u.Render(n,r);u.PostProcess();return};t.ViewModel.prototype.LoadRouteTable=function(n,i,r){var u=this;this.CreateService().Get(n,function(n){n.Routes.ForEach(function(i){var r=new t.Route(u,i,ch.Coalesce(n.Defaults,{}));ch.IsValid(u.Routes)||(u.Routes={});u.Routes[i.Name]=r;u.FirstSubRoute==null&&(u.FirstSubRoute=r)});ch.Do(i);r&&u.FirstSubRoute&&u.FirstSubRoute.Run(null,!0)})};t.ViewModel.prototype.RunRoute=function(n,t,i){var r=this.Routes[n];ch.IsValid(r)&&r.Run(t,i)};t.ViewModel.prototype.PreProcessModel=function(){this.ActualViewModel.PreProcessModel()};t.ViewModel.prototype.PostProcessModel=function(n){this.ActualViewModel.PostProcessModel(n)};t.ViewModel.prototype.OnError=function(n){this.ActualViewModel.OnError(n)};t.ViewModel.prototype.OnInfo=function(n){this.ActualViewModel.OnInfo(n)};t.ViewModel.prototype.Confirm=function(n,t,i){this.ActualViewModel.Confirm(n,t,i)};t.ViewModel.prototype.CreateService=function(){return this.ActualViewModel.CreateService()};t.ViewModel.prototype.AddWatcher=function(n,t,i){this.Watchers.AddWatcher(n,t);var r=this;i&&this.Deferred.push(function(){n.Eval(r,!0)})};t.ViewModel.prototype.RemoveWatcher=function(n){this.Watchers.RemoveWatcher(n)};t.ViewModel.prototype.UpdateView=function(){if(!this.Updated&&!this.SuppressUpdate){try{var i=this;this.Updated=!0;this.Watchers.UpdateView();this.Synced.ForEach(function(n){n.UpdateView()})}catch(t){n.Logger.Error(t.description)}this.Updated=!1}};t.ViewModel.prototype.Sync=function(n,t){this.Synced.push(n);t&&n.Sync(this,!1)};t.ViewModel.prototype.CreateCondition=function(t){var i=this.Conditions[t];return i==undefined&&(i=new n.Expression(this.ActualViewModel,t,!0),this.Conditions[t]=i),i};t.ViewModel.prototype.CreateExpression=function(t){var i=this.Expressions[t];return i==undefined&&(i=new n.Expression(this.ActualViewModel,t,!1),this.Expressions[t]=i),i};t.ViewModel.prototype.HandleClick=function(n,t,i,r){var u=this,f,e;if(t.indexOf("^")==0){if(f=n.FindAction(t.substr(1)),f!=null)return function(t){return t.$model=ch.Coalesce(t.$model,n.Model),t.$position=n.Position,t.$callback=r,!f.Run(t)&&i&&u.UpdateView(),!0}}else return e=u.ActualViewModel,function(r){return(r.$model=ch.Coalesce(r.$model,n.Model),r.$position=n.Position,i)?(e[t](r)||u.UpdateView(),!0):e[t](r)}}}(i,t);i.WatcherList=function(n){this.ViewModel=n;this.Count=0;this.Watchers=[{},{}]};i.WatcherList.prototype.AddWatcher=function(n,t){t==undefined&&(t=i.Priority.Default);n.Id=String(++this.Count);var r=this.Watchers[t==i.Priority.High?0:1];r[n.Id]=n};i.WatcherList.prototype.RemoveWatcher=function(n){var t=n.Id;this.Watchers.ForEach(function(n){return ch.IsValid(n[t])?(n[t].Removed=!0,delete n[t],!1):!0},!0)};i.WatcherList.prototype.UpdateView=function(){var t=this.ViewModel;this.Watchers.ForEach(function(i){var r=ch.ShallowClone(i);$.each(r,function(r,u){if(ch.IsValid(i[r])&&!u.Removed)try{u.Eval(t)}catch(f){n.Logger.Error(f.description)}})})};!function(t){function i(){n.Logger.Error("Non Cheetah elements not allowed in a variable")}t.Node=function(t,i,r,u){this.ParentContext=i;this.ViewModel=t;this.Element=r;this.NewElement=null;this.Model=u;this.Watchers=[];this.Index=i?i.Children.length:0;this.PreserveSpace=i?i.PreserveSpace:!1;this.Watch=!0;this.Builder=i?i.Builder:n.Builder;this.IsRenderLess=!1;i&&(i.Children.push(this),this.Watch=i.Watch);var f=ch.AttributeValue(r,"ch-watch");ch.IsEmpty(f)||(this.Watch=ch.Evaluate(this.EvaluateText(t,f))=="true")};t.Node.prototype.Clear=function(){};t.Node.prototype.GetLastRenderedChildElement=function(){return null};t.Node.prototype.EvaluateText=function(n,i){return i==null||i==undefined?"":t.IsCheetahExpression(i)?new t.TextExpression(n,this,i):$.trim(i)};t.Node.prototype.ProcessElement=function(){};t.Node.prototype.GetVar=function(n){return this.ParentContext?this.ParentContext.GetVar(n):null};t.Node.prototype.OnChange=function(){this.ParentContext&&this.ParentContext.OnChange()};t.Node.prototype.AddWatcher=function(n,t,i,r){this.Watchers.push(t);n.AddWatcher(t,i,r)};t.TextNode=function(n,i,r,u){if(t.Node.call(this,n,i,r,u),n){var f=r.nodeValue;this.Expression=this.EvaluateText(n,f);this.Watch&&typeof this.Expression!="string"&&this.Expression.Expressions.length>0&&this.AddWatcher(n,new t.TextNodeWatcher(n,this,this.Expression))}};t.TextNode.inherits(t.Node);t.TextNode.prototype.Clear=function(n){n&&this.NewElement&&(this.Builder.RemoveFromParent(this.NewElement),this.NewElement=null)};t.TextNode.prototype.RenderText=function(n,t,i){this.NewElement=this.Builder.RenderText(this.NewElement,n,t,i);this.NewElement&&(this.NewElement.$context=this)};t.TextNode.prototype.ProcessElement=function(n,t){var i=ch.Evaluate(this.Expression);this.PreserveSpace||(i=$.trim(i));this.RenderText(n,t,i)};t.TextNode.prototype.Render=function(n,t){return ch.IsValid(t)?(this.Model=t,this.ProcessElement(),!0):!1};t.VariableTextNode=function(n,i,r,u,f){r.nodeValue=$.trim(r.nodeValue);t.TextNode.call(this,n,i,r,u,!0);this.VariableElement=f};t.VariableTextNode.inherits(t.TextNode);t.VariableTextNode.prototype.ProcessElement=function(){var n=ch.Evaluate(this.Expression);typeof n=="string"&&(n=$.trim(ch.NormalizeText(n)));this.VariableElement.ParentContext.SetVar(this.VariableElement.VariableName,n)};t.Element=function(n,i,r,u){t.Node.call(this,n,i,r,u);this.Children=[];this.Variables={};this.Actions={};this.Name="";this.TransformInstance={};this.InTransform=i!=null?i.InTransform:null;this.OnRender=null;this.IsCheetahElement=!1;this.IgnoreText=!1;this.ResolveTransformInstance()};t.Element.inherits(t.Node);t.Element.prototype.GetNonCheetahAncestor=function(){for(var n=this.ParentContext;n!=null;){if(!n.IsCheetahElement&&n.Name.indexOf("ch-")==-1)return n;n=n.ParentContext}return null};t.Element.prototype.GetVar=function(n){return ch.IsValid(this.Variables[n])?this.Variables[n]:this.ParentContext?this.ParentContext.GetVar(n):null};t.Element.prototype.SetVar=function(n,t){this.Variables[n]=ch.Convert(t)};t.Element.prototype.CheckTemplateTransform=function(n,i){var r=t.Transforms[i.name],u;r&&r.UseTemplate&&(i.name="ch-call-template",i.templateName=r.UseTemplate,u=ch.AttributeValue(n,"ch-bind"),u&&this.Builder.SetAttribute(n,"bind",u),this.Builder.SetAttribute(n,"name",r.UseTemplate))};t.Element.prototype.CreateChild=function(i,r,u,f,e){var o=i.localName,s;if(o=="ch-else"||o=="ch-elseif"){if(this.LastIf){if(o=="ch-elseif")return this.LastIf.AddElseIf(i),null}else return t.LogError(o=="ch-else"?2:0),null;return this.LastIf.AddElse(i),this.ProcessLastIf(),null}this.ProcessLastIf();s={name:o,templateName:null};this.CheckTemplateTransform(i,s);try{switch(s.name){case"ch-bind":return new t.BindElement(r,this,i,this.Model,e);case"ch-if":return this.LastIf=new t.IfElement(r,this,i,this.Model),this.LastIf;case"ch-action":return this.CreateAction(i),null;case"ch-variable":return new t.Variable(r,this,i,this.Model),null;case"ch-call-template":return new t.CallTemplate(r,this,i,this.Model,s.templateName);case"ch-template-contents":return new t.TemplateContents(r,this,i,this.Model);default:return new t.DOMElement(r,this,i,this.Model)}}catch(h){return n.Logger.Error("Error creating child element ["+o+"]: "+h.description),null}};t.Element.prototype.Render=function(n,t,i,r){if(!ch.IsValid(t))return!1;var u=this,f=u.ViewModel;return t.$$id=f.ModelID++,t.$$index=-1,this.ProcessChildren(r),!0};t.Element.prototype.ResolveTransformInstance=function(){this.TransformInstance.$name=this.Name;this.TransformInstance.$parent=this.ParentContext?this.ParentContext.TransformInstance:null;this.TransformInstance.GetAncestor||(this.TransformInstance.GetAncestor=function(n){for(var t=this;t!=null;){if(t.$name==n)return t;t=t.$parent}return null})};t.Element.prototype.Clear=function(n,t){var i=this.ViewModel;t&&(this.Watchers.ForEach(function(n){i.RemoveWatcher(n)}),this.Watchers=[]);this.Children.ForEach(function(n){n.Clear(!0,!0)});this.NewElement!=null&&(n?(this.Builder.RemoveFromParent(this.NewElement),this.NewElement=null):this.Builder.SetContents(this.NewElement,""));this.Children=[]};t.ErrorMessages=["'ch-elseif' statement does not follow a 'ch-if' statement","An element with a 'ch-elseif' attribute does not follow an element with a 'ch-if' attribute","'ch-else' statement does not follow a 'ch-if' or 'ch-elseif' statement","An element with a 'ch-else' attribute does not follow an element with a 'ch-if' or 'ch-elseif' attribute","An action with the name '{0}' was not found!","Neither 'select' nor 'select-data' is specified for an action setter","'name' attribute missing on action setter","'select' attribute missing on action setter"];t.LogError=function(i){n.Logger.Error(t.ErrorMessages[i])};t.Element.prototype.FindAction=function(i){if(this.Actions[i])return this.Actions[i];if(this.ParentContext)return this.ParentContext.FindAction(i);if(t.Actions[i]){var r=new t.Action(this.ViewModel,this,t.Actions[i]);return this.AddAction(r),r}return n.Logger.Error(t.ErrorMessages[4].replace("{0}",i)),null};t.Element.prototype.AddAction=function(n){this.Actions[n.Name]=n};t.Element.prototype.ProcessElement=function(){this.ProcessChildren()};t.Element.prototype.GetLastRenderedChildElement=function(){for(var n,i,r=this.Children.length,t=r-1;t>=0;--t)if(n=this.Children[t],!n.IsRenderLess){if(n.NewElement)return n.NewElement;if(i=n.GetLastRenderedChildElement(),i)return i}return null};t.Element.prototype.GetChildrenRenderElement=function(n){return this.NewElement?this.NewElement.childNodes.length>0?(n.insert=2,this.NewElement.childNodes[0]):(n.insert=!1,this.NewElement):this.GetParentsChildrenRenderElement(n)};t.Element.prototype.GetParentsChildrenRenderElement=function(n){var t,i,r;if(!this.ParentContext)return null;for(t=this.Index-1;t>=0;--t){if(i=this.ParentContext.Children[t],i.NewElement)return n.insert=!0,i.NewElement;if(r=i.GetLastRenderedChildElement(),r)return n.insert=!0,r}return this.ParentContext.GetChildrenRenderElement(n)};t.Element.prototype.ProcessChildren=function(n,i){var r=this,u=null,e=0,o=this.Template!=null?this.Template.childNodes:this.Element.childNodes,f;i||(f={insert:n},i=this.GetChildrenRenderElement(f),n=f.insert);o.ForEach(function(f){var o,h,s;if(f.nodeName!="#comment")if(f.nodeName=="#text")r.IgnoreText||$.trim(f.nodeValue)==""||(o=null,o=r.Builder.CreateTextNode?r.Builder.CreateTextNode(r.ViewModel,r,f,r.Model):new t.TextNode(r.ViewModel,r,f,r.Model),o.ProcessElement(n,i),++e);else{if(h=f.localName,u=r.CreateChild(f,r.ViewModel),u==null)return;if(u.Index=e++,h=="ch-if")return;u.ProcessElement(n,i);u.PostProcess();n&&(s=u.NewElement?u.NewElement:u.GetLastRenderedChildElement(),s&&(i=s,n=1))}});return};t.Element.prototype.CreateAction=function(n){var r=new t.Action(this.ViewModel,this,n),u,i;if(ch.IsEmpty(r.Name)){if(u=this.Transform.NewName,i=r.Trigger,ch.IsEmpty(i))switch(u){case"button":case"a":i="click";break;case"select":i="change";break;default:i="mouseup"}if(i.indexOf("visibility")==-1&&i.indexOf("visible")==-1)$(this.NewElement).on(i,function(n){r.Run(n)});else ch.IsValid(this.VisibilityWatcher)&&(i.indexOf("true")!=-1?this.VisibilityWatcher.ShowAction=r:this.VisibilityWatcher.HideAction=r)}else this.AddAction(r);return};t.Element.prototype.ProcessLastIf=function(){this.LastIf&&(this.LastIf.ProcessElement(),this.LastIf.PostProcess(),this.LastIf=null)};t.Element.prototype.PostProcess=function(){this.ProcessLastIf();this.OnRender&&this.OnRender(this)};t.CheetahElement=function(n,i,r,u){t.Element.call(this,n,i,r,u);this.IsCheetahElement=!0;var f=ch.AttributeValue(r,"preserve-space");ch.IsEmpty(f)||(this.PreserveSpace=f.toLowerCase()=="true")};t.CheetahElement.inherits(t.Element);t.IfElement=function(n,i,r,u){t.CheetahElement.call(this,n,i,r,u);this.If=r;this.Else=null;this.ElseIf=[];this.RenderedIndex=-1;this.Watcher=null;var f=ch.AttributeValue(r,"test",!0);if(ch.IsEmpty(f))throw"Missing 'test' attribute for ch-if";this.Condition=n.CreateCondition(f);this.Watch&&(this.Watcher=new t.IfWatcher(n,this),this.AddWatcher(n,this.Watcher))};t.IfElement.inherits(t.CheetahElement);t.IfElement.prototype.Clear=function(n,t){t&&(this.Watcher=null);this.parent.Clear.call(this,n,t)};t.IfElement.prototype.FindBlock=function(n){if(this.Condition.Eval(this)){n(this.If,0);return}if(this.ElseIf.length>0){var t=0,i=this;if(this.ElseIf.IfAny(function(r){return(++t,r.Condition.Eval(i))?(n(r.Element,t),!0):!1}))return}this.Else?n(this.Else,-2):n(null,-1);return};t.IfElement.prototype.ProcessElement=function(n,i){var r=this,u=this.RenderedIndex;this.Watcher==null&&(this.Watcher=new t.IfWatcher(this.ViewModel,this),this.AddWatcher(this.ViewModel,this.Watcher));this.FindBlock(function(t,f){t&&u!=f?(n&&r.Clear(),r.Element=t,r.ProcessChildren(n,i),r.Element=r.If,r.RenderedIndex=f):t||(r.Clear(),r.RenderedIndex=-1)});return};t.IfElement.prototype.AddElseIf=function(n){var t=this.ViewModel.CreateCondition(ch.AttributeValue(n,"test",!0));t&&this.ElseIf.push({Element:n,Condition:t})};t.IfElement.prototype.AddElse=function(n){this.Else=n};t.Variable=function(n,i,r,u){if(t.CheetahElement.call(this,n,i,r,u),this.IsRenderLess=!0,this.VariableName=ch.AttributeValue(r,"name",!0),ch.IsEmpty(this.VariableName))throw"Missing variable name";var f=this.Element.innerHTML;t.IsCheetahExpression(f)||f.indexOf("<")!=-1?(this.Builder=new t.VariableBuilder(this,this.VariableName),this.ProcessChildren()):this.ParentContext.SetVar(this.VariableName,f)};t.Variable.inherits(t.CheetahElement);t.Variable.prototype.ProcessElement=function(){this.ProcessChildren()};t.VariableBuilder=function(n,i){this.VarContext=n;this.Context=n.ParentContext;this.Name=i;this.CreateTextNode=function(n,i,r,u){return new t.VariableTextNode(n,i,r,u,this.VarContext)}};t.VariableBuilder.prototype.FindElement=function(){return null};t.VariableBuilder.prototype.GetContents=function(){return""};t.VariableBuilder.prototype.SetContents=function(n,t){typeof t=="string"&&(t=$.trim(ch.NormalizeText(t)));this.Context.SetVar(this.Name,t)};t.VariableBuilder.prototype.RenderText=function(n,t,i,r){this.SetContents(null,r)};t.VariableBuilder.prototype.AppendChild=function(){i()};t.VariableBuilder.prototype.InsertBefore=function(){i()};t.VariableBuilder.prototype.InsertAfter=function(){i()};t.VariableBuilder.prototype.MoveElement=function(){i()};t.VariableBuilder.prototype.AppendText=function(n,t){this.SetContents(null,t)};t.VariableBuilder.prototype.InsertTextBefore=function(){i()};t.VariableBuilder.prototype.InsertTextAfter=function(){i()};t.VariableBuilder.prototype.RemoveChild=function(){i()};t.VariableBuilder.prototype.RemoveFromParent=function(){i()};t.Template=function(n,i){t.CheetahElement.call(this,n,null,i);this.IsCheetahElement=!0};t.Template.inherits(t.CheetahElement);t.CallTemplate=function(i,r,u,f,e){var s,o;if(t.CheetahElement.call(this,i,r,u,f),this.IsCheetahElement=!0,this.ContentElement=u,e||(e=ch.AttributeValue(u,"name",!0)),!e){n.Logger.Error("Missing template name");return}if(e=ch.Evaluate(this.EvaluateText(i,e)),s=t.Templates[e],!s){n.Logger.Error("Undefined template: "+e);return}this.Element=s.GetTemplate(i);o=this;u.attributes.ForEach(function(n){if(n.localName!="name"){var r=new t.VariableWatcher(i,o,n.localName,n.value);o.Watch&&o.AddWatcher(i,r,t.Priority.High);r.Eval(i,!0)}})};t.CallTemplate.inherits(t.CheetahElement);t.TemplateContents=function(i,r,u,f){t.CheetahElement.call(this,i,r,u,f);this.IsCheetahElement=!0;for(var e=this.ParentContext;ch.IsValid(e);){if(e.ContentElement){this.Element=e.ContentElement;break}e=e.ParentContext}ch.IsValid(e)||n.Logger.Error("'ch-template-contents' element not found within a 'ch-template' element")};t.TemplateContents.inherits(t.CheetahElement);t.BindElement=function(i,r,u,f,e){if(t.CheetahElement.call(this,i,r,u,f),this.BindPath=ch.AttributeValue(this.Element,"on",!0),this.Bind=this.BindPath,this.IsCheetahElement=!0,ch.IsEmpty(this.Bind))throw"Missing 'on' attribute for ch-bind";var o=!1,s=!0;n.IsExpressionText(this.Bind)?(this.Bind=this.ViewModel.CreateExpression(this.Bind),o=!0):(this.Bind=ch.GetModelValue(this.Model,this.Bind,this),Array.isArray(this.Bind)||(s=!1),o=!0);this.Sort=ch.AttributeValue(this.Element,"sort");o&&this.Watch&&!e&&(s?(ch.IsEmpty(this.Sort)||(this.Sort=this.EvaluateText(this.ViewModel,this.Sort)),this.AddWatcher(this.ViewModel,new t.BindArrayWatcher(this))):this.AddWatcher(this.ViewModel,new t.BindWatcher(this)))};t.BindElement.inherits(t.CheetahElement);t.BindElement.prototype.EvaluateBind=function(){if(!this.Bind)return null;if(this.Bind.Eval)return this.Bind.Eval(this,this.Model);var t=this.Bind,n=this.ViewModel.FixModel(this.Model);return this.Bind=ch.GetModelValue(n,this.BindPath,this),this.Bind&&(this.Bind.$$path=this.BindPath),this.Bind};t.BindElement.prototype.ProcessElement=function(){var n=this.EvaluateBind(),t,i;n&&(this.Sort&&n.length!=undefined&&n.length!=0&&(t=ch.Evaluate(this.Sort),ch.IsEmpty(t)||ch.Sort(n,t)),n.$$parent=this.Model,i=this.CreateChild(this.Element,this.ViewModel,!0),i.Model=n,i.Render(this.Element,n));return};t.BindElement.prototype.Render=function(n,i,r){if(!ch.IsValid(i))return!1;if(i.$$id=this.ViewModel.ModelID++,i.$$index=-1,typeof i!="string"&&i.length!=undefined){var u=0,f={insert:r},e=this.GetChildrenRenderElement(f),o=this,s=this.ViewModel;return r=f.insert,i.ForEach(function(f){var h,c;ch.IsValid(f)&&(f.$$id=s.ModelID++,f.$$parent=i,f.$$index=u,f.$$path="["+u,h=new t.DOMElement(s,o,n,f),h.Position=u,h.NewElement=o.NewElement,h.IsArrayElement=!0,h.ProcessChildren(r,e),h.PostProcess(),r&&(c=h.NewElement?h.NewElement:h.GetLastRenderedChildElement(),c&&(e=c,r=1)));u++})}return this.ProcessChildren(r),!0};t.DOMElement=function(n,i,r,u){t.Element.call(this,n,i,r,u);this.Transform=null;this.Name=this.TransformInstance.$name=r.localName;this.Position=0;this.RenderElement=!0;this.PreserveSpace=!1;this.Sort=null;this.Events=[];this.Route="";this.Condition=null;this.ConditionName=null;this.Template=null;this.Contents="";this.Bind="";this.Async=!1;this.Attributes=null;this.Class="";this.Style="";this.CondResult=!0;this.Position=i?i.Position:0};t.DOMElement.inherits(t.Element);t.DOMElement.prototype.ProcessElement=function(n,t){var i=this;this.PreProcess(n,t)&&!this.Transform.DontRenderChildren&&(this.Async?this.ViewModel.Async.push(function(){i.parent.ProcessElement.call(i,n,t)}):this.parent.ProcessElement.call(this,n,t));this.RenderElement&&this.Builder.EndElement();this.TransformMethod("PostProcess",function(n){n.PostProcess(i.NewElement)});return};t.DOMElement.prototype.SetAttribute=function(n,t){var i=this;this.TransformMethod("SetAttribute",function(r){r.SetAttribute(i.NewElement,n,t)})||this.Builder.SetAttribute(this.NewElement,n,t)};t.DOMElement.prototype.OnChange=function(){this.OnRender&&this.OnRender(this);this.parent.OnChange.call(this)};t.DOMElement.prototype.CheckTransform=function(){var i=t.Transforms[this.Name],u,r;if(i&&i.RequiredParent&&(u=this.GetNonCheetahAncestor(),r=i.RequiredParent.split(","),r.IfAny(function(n){return n==u.Name})||n.Logger.Error(i.Name+" must be a child of "+i.RequiredParent+" (ignoring Cheetah elements)")),ch.IsValid(i)?(this.InTransform=i,this.IgnoreText=i.IgnoreText,ch.IsEmpty(i.NewName)&&(this.RenderElement=!1),i.CreateInstance&&(this.TransformInstance=i.CreateInstance(),this.ResolveTransformInstance()),i.CreateBuilder&&(this.Builder=i.CreateBuilder(),this.TransformInstance&&i.CreateBuilder&&(this.TransformInstance.$builder=this.Builder))):(i=new l(this.Name),this.InTransform=this.ParentContext?this.ParentContext.InTransform:!1),this.Name.indexOf("ch-")==-1&&this.ParentContext&&this.ParentContext.InTransform&&this.ParentContext.InTransform.AllowedChildren){var r=this.ParentContext.InTransform.AllowedChildren.split(","),u=this.ParentContext,f=this;r.IfAny(function(n){return n==f.Name})||n.Logger.Error(this.Name+" is not allowed as a child of "+this.ParentContext.InTransform.Name+" (ignoring Cheetah elements)")}this.Transform=i};t.DOMElement.prototype.PreProcess=function(n,t){this.CheckTransform();var i=this;if(this.Name.indexOf("ch-")==0&&this.ProcessCheetahElement())return!1;if(this.RenderElement){if(this.ProcessAttributes(this.ViewModel),this.RenderNewElement(n,t))return!1}else this.Transform.IsIdentity||(this.TransformAttributes(function(){i.ProcessAttributes(i.ViewModel)}),this.TransformOnRender(null,this.Model));return!0};t.DOMElement.prototype.TransformOnRender=function(n,t){var i=this;this.TransformMethod("OnRender",function(i){i.OnRender(n,t)})};t.DOMElement.prototype.TransformAttributes=function(n){var t=this;this.TransformMethod("TransformAttributes",function(i){n&&n();i.TransformAttributes(t.Attributes)})};t.DOMElement.prototype.TransformMethod=function(n,t){if(this.TransformInstance&&this.TransformInstance[n])t(this.TransformInstance);else if(this.Transform[n])t(this.Transform);else return!1;return!0};t.DOMElement.prototype.ProcessCheetahElement=function(){var t=this.ViewModel;this.IsCheetahElement=!0;switch(this.Name.substr(3)){case"include":case"template":return!0;default:return n.Logger.Warning("Unknown Cheetah element: '"+this.Name+"'"),!0}return!1};t.DOMElement.prototype.ProcessAttributes=function(i){var o=this.Element.attributes,s=[],h,f,r,u,c,e;if(o!=null)for(h=o.length,f=0;f<h;++f)if(r=o[f],u=r.localName,u.indexOf("data-ch-")==0&&(u=u.substr(5)),u.indexOf("ch-")==0)switch(u.substr(3)){case"bind":this.Bind=ch.Evaluate(this.EvaluateText(i,r.value));break;case"async":this.Async=r.value.toLowerCase()=="true";break;case"preserve-space":this.PreserveSpace=r.value.toLowerCase()=="true";break;case"format":this.Format=this.EvaluateText(i,r.value);break;case"deformat":this.Deformat=this.EvaluateText(i,r.value);break;case"filter":this.Filter=r.value;this.Filter&&(this.Filter=new RegExp(this.Filter.replaceAll("\\\\","\\")));break;case"watch":break;case"visible":this.Watch&&this.AddWatcher(i,new t.VisibilityWatcher(i,this,r.value),t.Priority.Default,!0);break;case"html":this.Watch&&this.AddWatcher(i,new t.HtmlWatcher(i,this,r.value),t.Priority.Default,!0);break;case"click":case"blur":case"mouseover":case"mouseenter":case"mouseleave":this.Events.push({Name:u.substr(3),Value:r.value});break;case"checked":case"disabled":case"readonly":case"selected":this.Watch&&this.AddWatcher(i,new t.AttributeWatcher(i,this,u.substr(3),r.value,1),t.Priority.Default,!0);break;case"style":this.Style=r.value;break;case"class":this.Class=r.value;break;case"route":this.Route=ch.Evaluate(this.EvaluateText(i,r.value));break;default:n.Logger.Warning("Unknown Cheetah attribute: '"+u+"'")}else this.Watch&&t.IsCheetahExpression(r.value)&&(c=new t.AttributeNodeWatcher(i,this,u,r.value),this.AddWatcher(i,c,t.Priority.Default,!1)),e=String(ch.Evaluate(this.EvaluateText(i,r.value))),r.localName=="href"&&(e=e.replaceAll(" ","")),s.push(new n.Attribute(r.localName,e.replaceAll('"',"'")));this.Attributes=s;return};t.DOMElement.prototype.GetRenderParent=function(){for(var n=null,t=this.ParentContext;!n&&t;)n=t.NewElement,t=t.ParentContext;return n==null&&(n=this.Builder.FindElement(this.ViewModel.Container)),n};t.DOMElement.prototype.RenderNewElement=function(i,r){var e=this,u=this.ViewModel,o=!1,f=r,s,h,c;return(f||(s={insert:i},f=this.GetParentsChildrenRenderElement(s),i=s.insert),this.NewElement=i==2?this.Builder.InsertBefore(f,this.Transform.NewName):i?this.Builder.InsertAfter(f,this.Transform.NewName):this.Builder.AppendChild(f,this.Transform.NewName),this.NewElement&&(this.NewElement.$context=this),this.TransformAttributes(),this.IsCheetahElement||(h=this.NewElement,this.Attributes.ForEach(function(n){e.Builder.SetAttribute(h,n.Name,n.Value)})),this.TransformOnRender(this.NewElement,this.Model),this.IsCheetahElement)?o:this.Condition!=null&&!this.CondResult?o:(this.Transform.IsEditable&&this.Bind!=""&&(this.Watch&&this.TransformMethod("OnBind",function(){try{e.AddWatcher(u,new t.PropertyWatcher(u,e),t.Priority.Default,!0)}catch(i){n.Logger.Error(i.description)}}),this.ProcessChildren(),o=!0),this.Watch&&!ch.IsEmpty(this.Class)&&this.AddWatcher(u,new t.ClassWatcher(u,this,this.Class),t.Priority.Default,!0),this.Watch&&!ch.IsEmpty(this.Style)&&this.AddWatcher(u,new t.StyleWatcher(u,this,this.Style),t.Priority.Default,!0),this.Events.ForEach(function(n){e.RenderEvent(u,n.Name,n.Value)}),this.Route!=""&&(c=this.Route,$(this.NewElement).click(function(){u.RunRoute(c,null,!0)})),o)};t.DOMElement.prototype.RenderEvent=function(t,i,r){var u,f,e,o,s;if(!ch.IsEmpty(r)){if(u=this,r.indexOf(":")!=-1)if(f=r.split(":"),f.length!=2)n.Logger.Error("Syntax error on 'ch-'"+i+" attribute");else{e=$.trim(f[0]);o=t.CreateExpression($.trim(f[1]));$(this.NewElement).on(i,function(){var n=o.Eval(u);ch.SetModelValue(u.Model,e,ch.Clone(n));t.UpdateView()})}else{s=t.HandleClick(this,r,!0);$(u.NewElement).on(i,s)}return}}}(i,t);n.Attribute=function(n,t){this.Name=n;this.Value=t};i.Action=function(t,i,r,u){this.Steps=[];this.ViewModel=t;this.Name=r?ch.AttributeValue(r,"name"):"";this.NumAnimations=0;this.Trigger=r?ch.AttributeValue(r,"trigger"):"";this.Parent=u;this.OnFail=null;this.Run=function(t,i){try{var r=!1;return this.NumAnimations=0,this.Steps.ForEach(function(n){r=n(t)||r},!1),r&&!i&&this.ViewModel.UpdateView(),r}catch(u){n.Logger.Error(u.description)}return!1};var f=this;try{r.childNodes.ForEach(function(n){f.HandleStep(i,n)})}catch(e){n.Logger.Error("Error creating action ["+this.Name+"]: "+e.description)}};i.Action.prototype.EvalExpression=function(n,t,r){var o,u,f,e;return r?r.indexOf("$$")==-1&&!i.IsCheetahExpression(r)?ch.Convert(r):(o=this.ViewModel,u=ch.Coalesce(n.$model,t.Model),r=="$$target"||r=="//$$target//")?u:(f={},r.indexOf("$$result")!=-1&&(f.$$result=n.$$result),e=t.EvaluateText(this.ViewModel,r.replaceAll("$$target.","")),ch.Convert(ch.Evaluate(e,u,f))):r};i.Action.prototype.EvalSetter=function(n,t,f,e){var s=ch.AttributeValue(f,"data"),o;if(ch.IsEmpty(s)){if(o="",o=ch.IsValid(f.attributes.value)?ch.AttributeValue(f,"value"):f.innerHTML,!ch.IsValid(o)){i.LogError(5);return}ch.IsEmpty(o)&&(o="");var c=this.ViewModel,h=u(c,f),l=this;this.Steps.push(function(n){if(!r(h,n,t))return!1;var i=l.EvalExpression(n,t,o);return e(n,i)})}else this.Steps.push(function(n){if(!r(h,n,t))return!1;var i=$(ch.EventTarget(n)).data(s);return e(n,i)})};i.Action.prototype.EvalNamedSetter=function(n,t,r,u){var f=ch.AttributeValue(r,"name");if(ch.IsEmpty(f)){i.LogError(6);return}f=ch.Evaluate(t.EvaluateText(t.ViewModel,f));this.EvalSetter(n,t,r,function(n,t){return u(n,f,t)})};i.Action.prototype.EvalSelectSetter=function(n,t,r,u,f){var e=ch.AttributeValue(r,"select");if(ch.IsEmpty(e)){i.LogError(7);return}u?this.EvalNamedSetter(n,t,r,function(n,t,i){var r=ch.SelectTarget(n,e);f(r,t,i)}):this.EvalSetter(n,t,r,function(n,t){var i=ch.SelectTarget(n,e);f(i,t)})};i.Action.prototype.EvalClassSetter=function(n,t){var u=ch.AttributeValue(t,"select"),i=ch.AttributeValue(t,"add"),r=ch.AttributeValue(t,"remove");this.SetActionStep(n,t,function(n){var t=ch.SelectTarget(n,u);return ch.IsEmpty(r)||t.removeClass(r),ch.IsEmpty(i)||t.addClass(i),!1})};i.ShowElement=function(n,t){var i=null;i=n instanceof jQuery?n:typeof n=="string"?$("#"+n):$(n);i&&i.each(function(){this.$context&&this.$context.VisibilityWatcher?this.$context.VisibilityWatcher.Eval(this.$context.ViewModel,t):t?$(this).show():$(this).hide()})};i.Action.prototype.EvalVisibilitySetter=function(n,t){var r=ch.AttributeValue(t,"show"),u=ch.AttributeValue(t,"hide"),e="",o=!0,f=this;ch.IsEmpty(r)&&ch.IsEmpty(u)&&(e=ch.AttributeValue(t,"select"),o=ch.Convert(ch.AttributeValue(t,"value")));this.SetActionStep(n,t,function(t){return ch.IsEmpty(u)&&ch.IsEmpty(r)?i.ShowElement(ch.SelectTarget(t,f.EvalExpression(t,n,e)),o):(ch.IsEmpty(u)||i.ShowElement(ch.SelectTarget(t,f.EvalExpression(t,n,u)),!1),ch.IsEmpty(r)||i.ShowElement(ch.SelectTarget(t,f.EvalExpression(t,n,r)),!0)),!1})};i.Action.prototype.EvalChildConditionalSetter=function(t,i,r,u,f){var e=this.CreateChild(t,i),o;e==null?n.Logger.Error("No child steps for "+r+" step in action"):(o=this.ViewModel,this.SetActionStep(t,i,function(n){var t=!1;return o[r](u,function(){t=e.Run(n,!0)},f),t}))};i.Action.prototype.SetActionStep=function(n,t,i){var f=u(this.ViewModel,t);this.Steps.push(function(t){return r(f,t,n)?i(t):!1})};i.Action.prototype.HandleStep=function(t,r){var l,h,p,s,f,w,u,a,b,k,c;if(r.localName){l=r.localName.toLowerCase();h=this.ViewModel;switch(l){case null:break;case"propertysetter":this.EvalSelectSetter(self,t,r,!0,function(n,t,i){return n.attr(t,i),!1});break;case"stylesetter":this.EvalSelectSetter(self,t,r,!0,function(n,t,i){return n.css(t,i),!1});break;case"classsetter":this.EvalClassSetter(t,r);break;case"visibilitysetter":this.EvalVisibilitySetter(t,r);break;case"modelsetter":this.EvalNamedSetter(self,t,r,function(n,i,r){var u=null,f;return i.indexOf("$$root.")==0?(u=h.ActualViewModel.Model,i=i.substr(7)):u=ch.Coalesce(n.$model,t.Model),typeof r=="object"&&r.$$id&&(f=ch.GetModelValue(u,i),r=ch.Clone(r),r.$$id=h.ModelID++,r.$$index=-1,f&&(r.$$path=f.$$path,r.$$parent=f.$$parent)),ch.SetModelValue(u,i,r),!0});break;case"remove":this.EvalSelectSetter(self,t,r,!1,function(n){n.remove()});break;case"reloadmodel":this.SetActionStep(t,r,function(){return h.SuppressUpdate=!0,h.ActualViewModel.LoadModel(),!1});break;case"call":var e=ch.AttributeValue(r,"function"),v=!0,y=!1;e||(e=ch.AttributeValue(r,"action"),e?(e="^"+e.replace("^",""),y=!0):(e=$.trim(r.innerHTML),v=!1));e=ch.Evaluate(t.EvaluateText(this.ViewModel,e));c=v?this.CreateChild(t,r):null;p=this.ViewModel.HandleClick(t,e,!1,c);this.SetActionStep(t,r,function(n){var t=p(n);return t&&!y&&c?(n.$callback=null,c.Run(n,!0)):t});break;case"callback":this.SetActionStep(t,r,function(n){if(n.$callback){var t=n.$callback;return n.$callback=null,t.Run(n,!0)}return!1});break;case"run":s=ch.AttributeValue(r,"expr");ch.IsEmpty(s)&&(s=$.trim(r.innerHTML));s=i.RemoveExpressionDelimiters(s);s=this.ViewModel.CreateExpression(s);this.SetActionStep(t,r,function(n){var i={};return i.$$target=n.$model,s.Eval(t,n.$model,i),!0});break;case"writeconsole":f=$.trim(r.innerHTML);f=t.EvaluateText(this.ViewModel,f);this.SetActionStep(t,r,function(t){var i={};t.$$result&&(i.$$result=t.$$result);n.Logger.Error(ch.Evaluate(f,null,i))});break;case"message":var f=$.trim(r.innerHTML),d=ch.AttributeValue(r,"type"),u=ch.AttributeValue(r,"title");u&&(u=t.EvaluateText(this.ViewModel,u));f=t.EvaluateText(this.ViewModel,f);this.SetActionStep(t,r,function(n){var t={};n.$$result&&(t.$$result=n.$$result);f=ch.Evaluate(f,null,t);u&&(u=ch.Evaluate(u,null,t));switch(d){case"error":h.OnError(f,u);break;default:h.OnInfo(f,u)}});break;case"confirm":w=ch.AttributeValue(r,"message");u=ch.AttributeValue(r,"title");u&&(u=t.EvaluateText(this.ViewModel,u));this.EvalChildConditionalSetter(t,r,"Confirm",w,u);break;case"validate":a=new i.Validator(this.ViewModel,t,r,this);a.IsValid&&this.Steps.push(function(n){a.Validate(n)});break;case"redirect":b=$.trim(r.innerHTML);this.SetActionStep(t,r,function(){ch.Redirect(b)});break;case"onfail":this.Parent&&(this.OnFail=this.CreateChild(t,r));break;case"delay":k=o(t,r,"for");c=this.CreateChild(t,r);this.SetActionStep(t,r,function(n){var t=Number(ch.Evaluate(k));ch.IsValidNumber(t)||(t=100);setTimeout(function(){c.Run(n)},t)});break;default:this.HandleCustomStep(t,r,l)}}};i.Action.prototype.CreateChild=function(n,t){if(!ch.IsEmpty(t.childNodes)){var r=new i.Action(this.ViewModel,n,t,this);if(r.Steps.length!=0)return r}return null};i.Action.prototype.HandleCustomStep=function(t,r,u){var f=i.ActionSteps[u],o=this;if(f){var s={},e=null,h=this.ViewModel;f.ProcessAttributes&&(s=f.ProcessAttributes(r.attributes,r)||{});f.AllowChildren&&(e=this.CreateChild(t,r));this.SetActionStep(t,r,function(r){var l,u,a,c,y,v;try{f.IsAnimation&&++o.NumAnimations;l=h.ActualViewModel;u=ch.Clone(s);for(a in u)c=u[a],(i.IsCheetahExpression(c)||c=="$$target")&&(u[a]=o.EvalExpression(r,t,c));return e==null?f.Run(r,t.NewElement,l,u):(y=ch.IsValid(t.ParentContext)?t.ParentContext.NewElement:null,r.$$result={},v=null,e.OnFail&&(v=function(){e.OnFail.Run(r)}),f.Run(r,y,l,u,function(){e.Run(r)},v))}catch(p){return n.Logger.Error(p.description),!1}})}else n.Logger.Warning("Unknown Action step: "+r.localName)};i.ValidatorItem=function(t,i,f){function c(n,t,i,r,u,f){var o="",s=f,e;this.ErrorMessage="";e=u.indexOf(";");o=u;e!=-1&&(this.ErrorMessage=t.EvaluateText(n,u.substr(e+1)),o=t.EvaluateText(n,u.substr(0,e)));this.Validate=function(n,t){var r={$$root:n.Model},i=ch.Convert(ch.Evaluate(o,t,r));return ch.IsEmpty(i)?!0:s(i,t)}}var e=ch.AttributeValue(f,"name"),o=[],s=u(t,f),h=i;this.IsValid=!ch.IsEmpty(e);this.ErrorMessage="";this.AddValidator=function(n,t,i,r){var u=ch.AttributeValue(t,i);ch.IsEmpty(u)||o.push(new c(n,h,t,i,u,r))};this.Validate=function(n,t,i,u,f){if(!r(s,t,i))return!0;var h=ch.Coalesce(t.$model,i.Model),c=!0;return h=ch.GetBindData(e,h),o.ForEach(function(t){if(!t.Validate(n,h)){c=!1;var i={$$root:n.Model};if(u.push({Name:e,Message:ch.Evaluate(t.ErrorMessage,h,i)}),f)return!1}return!0},!0),c};this.IsValid?(this.AddValidator(t,f,"required",function(n,t){return!n||!ch.IsEmpty(t)}),this.AddValidator(t,f,"minlength",function(n,t){return n==0||!ch.IsEmpty(t)&&t.length>=n}),this.AddValidator(t,f,"minvalue",function(n,t){return Number(t)>=n}),this.AddValidator(t,f,"maxvalue",function(n,t){return Number(t)<=n})):n.Logger.Error("Validate action step is missing a name for Model item.")};i.Validator=function(t,f,e,o){var v=t,s=f,p=ch.Convert(ch.AttributeValue(e,"report-silent")),h=ch.Convert(ch.AttributeValue(e,"report-all")),c=ch.AttributeValue(e,"report-to"),w=u(t,e),l=null,a=null,y=[];this.IsValid=!0;e.childNodes.ForEach(function(r){if(ch.IsValid(r.localName))switch(r.localName.toLowerCase()){case"model":var u=new i.ValidatorItem(t,s,r);u.IsValid&&y.push(u);break;case"onvalidate":l=o.CreateChild(f,r);break;case"onfail":a=o.CreateChild(f,r);break;default:n.Logger.Error("Unknown child step for Validate action step.")}});this.Validate=function(n){var t,u,i;if(r(w,n,s)){if(t=[],u=!0,y.ForEach(function(i){return!i.Validate(v,n,s,t,!h)&&(u=!1,!h)?!1:!0},!0),!u){p||(i="Validation failed!",t.length>0&&(i=h?ch.IsEmpty(c)?t.Pack("\r\n",function(n){return n.Message}):"<ul>"+t.Pack("\r\n",function(n){return"<li>"+n.Message+"<\/li>"})+"<\/ul>":"<ul><li>"+t[0].Message+"<\/li><\/ul>"),ch.IsEmpty(c)?v.OnError(i):$(c).html(i));a&&(n.$$result=t,a.Run(n));return}l!=null&&l.Run(n)}}};i.Watcher=function(n){this.IsWatcher=!0;this.ViewModel=n;this.Eval=function(){}};i.ElementWatcher=function(n,t){i.Watcher.call(this,n);this.Context=t;this.ReRender=function(n,t,i,r){i=ch.Coalesce(i,this.Context);i.Clear(r,r);(t==undefined||t)&&(i.Render(i.Element,n,!0),this.ViewModel.ProcessDeferred())}};i.Property=function(n,t){var i=n.indexOf(".")!=-1?n.split("."):n,r=t;this.SetValue=function(n){ch.SetModelValue(r,i,n)};this.GetValue=function(n){return i=="__expr__"?i:(n&&(r=n),ch.GetModelValue(r,i))}};i.PropertyWatcher=function(t,r){function h(n){n.TransformMethod("SetValue",function(i){n.Model.$$id||(n.Model=t.FixModel(n.Model));var r=f.GetValue(n.Model);n.Format&&(r=ch.Evaluate(n.Format,null,{$$value:r}));r||(r="");i.SetValue(n.NewElement,r)})}var u,f,o,e,s;if(i.ElementWatcher.call(this,t,r),u=!1,f=r.Bind,this.OnChange=function(n){u||(u=!0,r.Deformat&&(n=ch.Evaluate(r.Deformat,null,{$$value:n})),f.SetValue(n),this.ViewModel.UpdateView(),u=!1)},this.OnBlur=function(){if(!u){u=!0;var t=n.Builder.GetValue(r.NewElement);t=ch.Evaluate(r.Format,null,{$$value:t});n.Builder.SetValue(r.NewElement,t);u=!1}},this.OnKeyPress=function(){return event.returnValue=r.Filter.test(String.fromCharCode(event.keyCode))?!0:!1},this.OnPaste=function(){var t=clipboardData.getData("text"),i,n;if(t)for(i=t.length,n=0;n<i;++n)if(!r.Filter.test(t[n]))return event.returnValue=!1;return event.returnValue=!0},this.Eval=function(){u||h(this.Context)},o=f.split(":"),o.length==2&&(f=$.trim(o[0])),e=this,s=f,f=new i.Property(f,r.Model),r.TransformMethod("OnBind",function(n){n.OnBind(r.NewElement,s,function(n){e.OnChange(n)})}),r.Transform.NewName=="input"||r.Transform.NewName=="textarea"){if(r.Format)$(r.NewElement).on("blur",function(){e.OnBlur()});if(r.Filter){$(r.NewElement).on("keypress",function(n){return e.OnKeyPress(n)});$(r.NewElement).on("paste",function(n){return e.OnPaste(n)})}}};i.ModelWatcher=function(t,r){function e(n,t){this.Attribute=new i.Property(t,n.Model);this.Value=this.Attribute.GetValue();this.Changed=function(){var n=this.Attribute.GetValue(),t;return n=="__expr__"?!0:(t=this.Value!=n,this.Value=n,t)}}function o(n,t){this.Name=t;this.Value=n.GetVar(t);this.Changed=function(n){var t=n.GetVar(this.Name),i=this.Value!=t;return this.Value=t,i}}i.ElementWatcher.call(this,t,r);var u=new n.KeyedSet,f=new n.KeyedSet;this.ModelChanged=function(n,t,i){var e=this.Context,r;if(n=ch.Coalesce(n,e.Model),!n)return!0;if(r=n,ch.IsEmpty(n.$$path)||(r=ch.GetModelValue(n.$$parent,n.$$path,this.Context)),!r||r.$$id==undefined||r.$$id!=n.$$id){if(r)r.$$parent=n.$$parent;else if(n.$$parent)return delete n.$$parent.$$id,!0;return this.ReRender(r,null,null,i),!1}return(t!=undefined&&(t.Model=r),u.IfAny(function(t){return t.Changed(n)}))?!0:f.IfAny(function(n){return n.Changed(e)})};this.AddProperty=function(n,t){u.Contains(t)||u.Add(t,new e(n,t))};this.AddVariable=function(n,t){f.Contains(t)||f.Add(t,new o(n,t))};this.AddProperties=function(n,t){if(ch.IsValid(t)){typeof t=="string"&&this.AddProperty(n,t);var i=this;ch.IsValid(t.length)&&t.ForEach(function(t){i.AddProperty(n,t)})}};this.AddVars=function(n,t){if(ch.IsValid(t)){typeof t=="string"&&this.AddVariable(n,t);var i=this;ch.IsValid(t.length)&&t.ForEach(function(t){i.AddVariable(n,t)})}}};i.BindWatcher=function(n){function r(n){n.Children&&n.Children.ForEach(function(t){n.Model&&n.Model.$$id&&delete n.Model.$$id;r(t)})}i.ModelWatcher.call(this,n.ViewModel,n);var e=n.ViewModel,u=!1,t=f(n.EvaluateBind());this.BaseReRender=this.ReRender;this.BaseModelChanged=this.ModelChanged;this.ModelChanged=function(){u=!1;var i=t,n=this.Context.EvaluateBind();return(n&&(n.$$parent=this.Context.Model,i&&(n.$$path=i.$$path)),this.BaseModelChanged(n,{}))?(t=f(n),!0):!1};this.ReRender=function(){r(this.Context)};this.Eval=function(){this.ModelChanged()&&this.ReRender(t)}};i.BindArrayWatcher=function(n){i.ModelWatcher.call(this,n.ViewModel,n);var t=n.EvaluateBind(),r=t.length;this.FixArray=function(n,t,i){return(i||n.length>r||!n.$$parent||!n.$$id)&&this.Context.Sort&&ch.Sort(n,ch.Evaluate(this.Context.Sort)),r=n.length,n.$$parent=this.Context.Model,n.$$path=this.Context.BindPath,n};this.ModelChanged=function(){var n=this.Context.EvaluateBind();return r!=t.length||n&&s(n,t)?(t=this.FixArray(n,t,!0),!0):!1};this.Eval=function(){this.ModelChanged()&&this.ReRender(t)}};i.IfWatcher=function(n,t){i.ElementWatcher.call(this,n,t);var r=[],u=[],f=ch.ShallowClone(t.Model);r.push(t);u.push(t.Condition.Eval(t));this.AddElse=function(n){r.push(n);u.push(n.Condition.Eval(n))};this.Eval=function(){this.Context.ProcessElement(!0,null)}};i.TextExpression=function(n,t,i){this.ViewModel=n;this.Context=t;this.OriginalText=i;this.Parts=[];this.Expressions=[];this.Init(i)};i.TextExpression.prototype.Evaluate=function(n,t){if(this.Expressions.length==0)return this.Parts.Pack("");if(this.Expressions.length==1&&this.Parts.length==1)return this.Parts[0].Eval(this.Context,n,t);var i=this;return this.Parts.Reduce(function(r,u){return typeof u=="string"?r+u:r+ch.NormalizeText(u.Eval(i.Context,n,t))},"")};i.TextExpression.prototype.Init=function(t){for(var i=t.indexOf(n.StartDelimiter),f=t,u,r;i!=-1;){if(i>0&&this.Parts.push(t.substr(0,i)),t=t.substr(i+n.StartDelimiter.length),i=t.indexOf(n.EndDelimiter),i==-1)break;u=$.trim(t.substr(0,i));t=t.substr(i+n.EndDelimiter.length);r=this.ViewModel.CreateExpression(u);this.Parts.push(r);this.Expressions.push(r);i=t.indexOf(n.StartDelimiter)}t!=""&&this.Parts.push(t);return};i.TextExpressionWatcher=function(n,t,r){var u,f;i.ModelWatcher.call(this,n,t);u=typeof r=="string"?new i.TextExpression(n,t,r):r;this.Eval=function(n,t){(t||this.ModelChanged())&&this.Resolve(u.Evaluate())};this.Resolve=function(){};f=this;u.Expressions.ForEach(function(n){f.AddProperties(t,n.ModelTokens);f.AddVars(t,n.VarTokens)})};i.TextNodeWatcher=function(n,t,r){i.TextExpressionWatcher.call(this,n,t,r);this.Resolve=function(n){this.Context.RenderText(null,null,n);this.Context.OnChange()}};i.AttributeNodeWatcher=function(n,t,r,u){i.TextExpressionWatcher.call(this,n,t,u);var f=r;this.Resolve=function(n){this.Context.SetAttribute(f,n)}};i.VariableWatcher=function(n,t,r,u){i.TextExpressionWatcher.call(this,n,t,u);var f=r;this.Resolve=function(n){this.Context.SetVar(f,n)}};i.ClassWatcher=function(n,t,r){function e(t){var i=t.indexOf(":");i==-1?(this.Name=t,this.Condition=null):(this.Name=$.trim(t.substr(0,i)),this.Condition=n.CreateCondition(t.substr(i+1)));this.Set=function(n,t){var i=this.Condition==null,r;return i||(i=this.Condition.Eval(n)),r="",ch.IsEmpty(t)||(r=ch.Evaluate(t)+" "),i&&(r+=this.Name),n.NewElement.className=$.trim(r),i}}i.ModelWatcher.call(this,n,t);this.Static=t.EvaluateText(n,ch.AttributeValue(t.NewElement,"class"));this.Parts=[];this.Eval=function(n,t){if(t||this.ModelChanged()){var i=this;this.Parts.ForEach(function(n){return!n.Set(i.Context,i.Static)},!0)}};var f=r.split(","),u=this;f.ForEach(function(n){var i=new e(n);u.Parts.push(i);i.Condition!=null&&(u.AddProperties(t,i.Condition.ModelTokens),u.AddVars(t,i.Condition.VarTokens))})};i.StyleWatcher=function(t,r,u){function o(n){var i=n.indexOf(":");this.Name=$.trim(n.substr(0,i));this.Expression=t.CreateExpression(n.substr(i+1));this.Eval=function(n){return this.Expression.Eval(n)}}i.ModelWatcher.call(this,t,r);this.Static=r.EvaluateText(t,ch.AttributeValue(r.NewElement,"style"));this.Parts=[];this.Eval=function(t,i){var r,u;(i||this.ModelChanged())&&(r=this,ch.IsEmpty(this.Static)||(u=this.Static.split(";"),u.ForEach(function(t){var i=t.split(":");n.Builder.css(r.Context.NewElement,i[0],i[1])})),this.Parts.ForEach(function(t){var i=t.Eval(r.Context);n.Builder.css(r.Context.NewElement,t.Name,i)}))};var e=u.split(";"),f=this;e.ForEach(function(n){var t=new o(n);f.Parts.push(t);f.AddProperties(r,t.Expression.ModelTokens)})};i.AttributeWatcher=function(n,t,r,u,f){i.ModelWatcher.call(this,n,t);var s=f==1,e=r,o=f==1?n.CreateCondition(u):n.CreateExpression(u);this.Eval=function(n,t){if(t||this.ModelChanged()){var i=o.Eval(this.Context);s?i?this.Context.SetAttribute(e,e):this.Context.Builder.RemoveAttribute(this.Context.NewElement,e):this.Context.SetAttribute(e,i)}};ch.IsEmpty(o.ModelTokens)||this.AddProperties(t,o.ModelTokens)};i.HtmlWatcher=function(n,t,r){i.ModelWatcher.call(this,n,t);var f=r,u=t,e=ch.GetModelValue(t.Model,f,t);this.ReRender=function(n){u.Builder.SetContents(u.NewElement,n?n:"")};this.Eval=function(n,t){var i=u.Model,r;i.$$parent&&i.$$path&&(i=i.$$parent[i.$$path]);r=ch.GetModelValue(i,f,u);(t||r!=e)&&this.ReRender(e=r)}};i.VisibilityWatcher=function(t,r,u){i.ElementWatcher.call(this,t,r);this.Condition=t.CreateCondition(u);this.HideAction=null;this.ShowAction=null;this.PreviousResult=undefined;r.VisibilityWatcher=this;this.Eval=function(t,i){var r=this.Condition.Eval(this.Context),u;if(i||this.PreviousResult==undefined||r!=this.PreviousResult){if(u=r?this.ShowAction:this.HideAction,this.PreviousResult=r,u!=null&&(u.Run(),u.NumAnimations>0))return;n.DOMBuilder.prototype.ShowElement(this.Context.NewElement,r)}}};n.Transform=function(){this.GetValue=function(t){return n.Builder.GetValue(t)};this.SetValue=function(t,i){n.Builder.SetValue(t,i)};this.OnBind=function(n,t,i){var r=["change"],u,f;switch(this.NewName){case"textarea":r.push("keyup");r.push("paste");r.push("cut");break;case"input":switch(n.type){case"text":case"password":case"email":case"date":case"number":case"url":r.push("keyup");r.push("paste");r.push("cut");r.push("input")}}u=t.split(":");u.length==2&&(r=r.splice(0,r.length),r.push($.trim(u[1])));f=this;r.ForEach(function(t){if(t)$(n).on(t,function(n){var t=f.GetValue(ch.EventTarget(n));i(t)})})}};n.Service=function(){this.RootFolder=ch.UrlRoot()};n.Service.prototype.GetResult=function(n){return ch.IsValid(n)?ch.IsValid(n.Result)?n.Result:n:null};n.Service.prototype.IsResultError=function(n){return ch.IsValid(n.Errors)||ch.IsValid(n.Error)};n.Service.prototype.GetErrorResult=function(n){return n};n.Service.prototype.OnError=function(n,t){ch.IsValid(t)?t(n):alert(n)};n.Service.prototype.NormalizeUrl=function(n,t){return(n=n.replaceAll("\\","/"),n.indexOf("~")==-1)?n.indexOf("/")==-1&&!ch.IsEmpty(t)?this.RootFolder.EnsureEndsWith("/")+(t?t+"/":"")+n:n:n.replace("~/",this.RootFolder.EnsureEndsWith("/"))};n.Service.prototype.LoadModel=function(n,t,i,r,u){this.QueryFolder(n,t,"models",i,r,u,"LoadModel")};n.Service.prototype.LoadView=function(n,t,i,r,u){this.QueryFolder(n,t,"views",i,r,u,"LoadView")};n.Service.prototype.DoAction=function(n,t,i,r){this.QueryFolder(n,"POST","actions",t,i,r,"DoAction")};n.Service.prototype.QueryFolder=function(t,i,r,u,f,e,o){i=="POST"||i=="GET"?this.Query(this.NormalizeUrl(t,r),i,u,f,e):n.Logger.Error("Only 'POST' or 'GET' for Cheetah.Service."+o)};n.Service.prototype.Post=function(n,t,i,r){this.Query(n,"POST",t,i,r)};n.Service.prototype.Put=function(n,t,i,r){this.Query(n,"PUT",t,i,r)};n.Service.prototype.Get=function(n,t,i){this.Query(n,"GET",null,t,i)};n.Service.prototype.Delete=function(n,t,i){this.Query(n,"DELETE",null,t,i)};n.Service.prototype.Query=function(n,t,i,r,u,f){var e=this;f||(f={});f.url=n;f.method=t;f.data=i;jQuery.ajax(f).done(function(n){n=e.GetResult(n);ch.IsValid(n)&&(e.IsResultError(n)?e.OnError(e.GetErrorResult(n),u):ch.IsValid(r)&&r(n))}).fail(function(t,i,r){r=="Not Found"&&(r+=": "+n);e.OnError(r,u)})};i.Route=function(n,t,i){var w=t.Name,f=ch.Coalesce(t.Target,i.Target),a=ch.Coalesce(t.Model,i.Model),v=ch.Coalesce(t.ModelVerb,i.ModelVerb,"POST"),s=ch.Coalesce(t.ViewModel,i.ViewModel),e=ch.Coalesce(t.View,i.View),y=ch.Coalesce(t.ViewVerb,i.ViewVerb,"POST"),h=ch.Coalesce(t.RouteTable,i.RouteTable),r=null,u=null,p=n,c=null,o,l;this.Run=function(n,t){var i=this,o="?v="+Math.floor(Math.random()*100),f;if(u==null&&!ch.IsEmpty(e)){p.CreateService().LoadView(e+o,y,null,function(r){u=r;i.Run(n,t)});return}if(r==null&&(r=c(),r.ModelPath=a+o,r.ModelVerb=v,r.Template=u),!ch.IsEmpty(h)&&!r.HaveRoutes()){r.LoadRouteTable(h,function(){i.Run(n,t)});return}f=n;i=this;t&&(f=function(){ch.IsValid(r.FirstSubRoute)?r.FirstSubRoute.Run(n):ch.Do(n)});r.LoadModel(null,f)};o="Cheetah.ViewModel";ch.IsEmpty(s)||(o=s);l="return new "+o+"('"+f+"')";c=new Function(l);!ch.IsValid(e)&&ch.IsValid(f)&&(u=$("#"+f).html())};i.LoadFileTask=function(t,i){n.Task.call(this);var r=t,u=i;this.Html="";this.Start=function(){var t=this;r.Get(r.NormalizeUrl(u),function(n){t.Html=n;t.Complete=!0;t.OnComplete()},function(i){n.Logger.Error(i);t.Complete=!0;t.OnComplete()})}};i.RequireAttribute=function(t,i,r,u){var f=ch.AttributeValue(t,i);return ch.IsEmpty(f)?(r&&n.Logger.Error(r),!1):(u&&u(f),!0)};i.RequireContent=function(t,i,r){var u=n.Builder.InnerText(t);return ch.IsEmpty(u)?(i&&n.Logger.Error(i),!1):(r&&r(u),!0)};i.IsCheetahExpression=function(t){var i,r;return!t||typeof t!="string"?!1:(i=t.indexOf(n.StartDelimiter),i==-1)?!1:(r=t.indexOf(n.EndDelimiter,i+n.StartDelimiter.length),r!=-1)};i.RemoveExpressionDelimiters=function(t){return t=$.trim(t),t.indexOf(n.StartDelimiter)==0&&(t=t.substr(n.StartDelimiter.length),t.lastIndexOf(n.EndDelimiter)==t.length-n.EndDelimiter.length&&(t=t.substr(0,t.length-n.EndDelimiter.length))),t};i.TemplateReference=function(n){this.Html=n;this.Template=null};i.TemplateReference.prototype.GetTemplate=function(n){return this.Template||(this.Template=n.CreateTemplate(this.Html)),this.Template};e=new function(){function e(t){var r=null,u;return n.Builder.ProcessElementsByName("ch-include",function(n){i.RequireContent(n,"Missing include path",function(n){t.push(n)})},!0)>0&&(u=n.Builder.FirstElementByName("body"),r=n.Builder.AppendChild(u,"div",function(n){n.style.display="none"})),r}var t=[],r=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(){n.Builder.ProcessElementsByName("ch-template",function(t){i.RequireAttribute(t,"name","Missing template name",function(r){i.Templates[r]=new i.TemplateReference(n.Builder.InnerHTML(t))})},!0);this.IsMet=!0}},u=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(t){t&&(t.childNodes.ForEach(function(n){n&&n.localName&&n.localName=="ch-action"&&i.RequireAttribute(n,"name","Missing action name",function(t){i.Actions[t]=n})}),n.Builder.RemoveFromParent(t));this.IsMet=!0}},f=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(f){var s=new n.Service,h=this,e=new n.TaskList(999999),o=[];t.ForEach(function(n){var t=new i.LoadFileTask(s,n);o.push(t);e.Add(t)});e.Run(function(){var t=new n.StringBuilder;o.ForEach(function(n){t.Append(n.Html)});f.innerHTML=t.ToString("\r\n");h.IsMet=!0;r.Start(f);u.Start(f)})}};this.Init=function(){var i=this,n=e(t);t.length!=0?f.Start(n):(f.IsMet=!0,r.Start(n),u.Start(n))}};$(t).ready(function(){var t,r,i,u;n.Builder=new n.DOMBuilder;n.Logger=new n.ConsoleLogger;e.Init();try{t=n.Builder.FirstElementByName("body");r=n.Builder.GetAttribute(t,"ch-mode",!0);r=="auto"&&(i=n.Builder.GetAttribute(t,"ch-route-table",!0),ch.IsEmpty(i)||(u=new n.ViewModel("body"),u.LoadRouteTable(i,null,!0)))}catch(f){n.Logger.Error(f.description)}})}(Cheetah,document);!function(n,t){function i(n,t){var i=n.nextSibling;return i?i.parentNode.insertBefore(t,i):n.parentNode.appendChild(t),t}n.StringBuilder=function(n){this._parts=[];ch.IsValid(n)&&this.Append(n)};n.StringBuilder.prototype.Clear=function(){this._parts=[]};n.StringBuilder.prototype.Append=function(n){this._parts.push(n)};n.StringBuilder.prototype.AppendLine=function(n){this.Append(n+"\r\n")};n.StringBuilder.prototype.ToString=function(n){return ch.IsValid(n)||(n=""),this._parts.join(n)};n.StringBuilder.prototype.ForEach=function(n,t){return this._parts.ForEach(n,t)};n.StringBuilder.prototype.Replace=function(n,t){this._parts[n]=t};n.KeyedSet=function(){var n=[],t={};this.Add=function(i,r){this.Contains(i)||(n.push(r),t[i]=r)};this.Contains=function(n){return t[n]!=undefined};this.IfAny=function(t){return n.IfAny(t)}};n.Session=new function(){this.SetValue=function(t,i){typeof Storage!="undefined"?sessionStorage.setItem(t,i):n.Cookie.SetValue(t,i)};this.GetValue=function(t){return typeof Storage!="undefined"?sessionStorage.getItem(t):n.Cookie.GetValue(t)};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(t){typeof Storage!="undefined"?sessionStorage.removeItem(t):n.Cookie.ClearValue(t)}};n.Storage=new function(){this.SetValue=function(t,i){typeof Storage!="undefined"?localStorage.setItem(t,i):n.Cookie.SetValue(t,i,5256e3)};this.GetValue=function(t){return typeof Storage!="undefined"?localStorage.getItem(t):n.Cookie.GetValue(t)};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(t){typeof Storage!="undefined"?localStorage.removeItem(t):n.Cookie.ClearValue(t)}};n.Cookie=new function(){this.SetValue=function(n,i,r){if(r)if(ch.IsEmpty(i)||i.indexOf("=")==-1||ch.IsValid(r))if(ch.IsValid(r)){var u=new Date(Date.now()+(r?r*6e4:0));t.cookie=n+"="+escape(i)+";expires="+u.toUTCString()}else t.cookie=n+"="+escape(i);else t.cookie=i;else t.cookie=n+"="+escape(i)};this.GetValue=function(n){var i,r;return t.cookie.length>0&&(i=t.cookie.indexOf(n+"="),i!=-1)?(i+=n.length+1,r=t.cookie.indexOf(";",i),r==-1&&(r=t.cookie.length),unescape(t.cookie.substring(i,r))):""};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(n){this.SetValue(n,"",-1e3)}};n.Task=function(n){var t=n;this.OnComplete=null;this.Complete=!1;this.Start=function(){var n=this;if(t)try{t(function(){ch.IsValid(n.OnComplete)&&n.OnComplete();n.Complete=!0})}catch(i){alert(i.description)}}};n.TaskList=function(n){var t=[],i=0,r=!1,f=n==undefined?8:n,u;this.Add=function(n){var i=this;n.OnComplete=function(){i.TaskComplete()};t.push(n)};this.Run=function(n){u();var r=this;n&&(i==0&&t.length==0?n():setTimeout(function(){r.Run(n)},10))};u=function(){if(!r){r=!0;try{while(t.length>0&&i<f){var n=t.shift();++i;n.Start()}}catch(u){}r=!1}};this.TaskComplete=function(){--i<f&&u()}};n.ConsoleLogger=function(){};n.ConsoleLogger.prototype.Error=function(n){console.error("CheetahJS: "+n)};n.ConsoleLogger.prototype.Warning=function(n){console.warn("CheetahJS: "+n)};n.ConsoleLogger.prototype.Log=function(n){console.log("CheetahJS: "+n)};n.DOMBuilder=function(){};n.DOMBuilder.prototype.GetValue=function(n){var t=null;return n.localName=="input"&&(n.type=="checkbox"||n.type=="radio")?n.checked:(t=n.localName=="select"?n.selectedIndex>=0?n.options[n.selectedIndex].value:"":n.value,ch.Convert(t))};n.DOMBuilder.prototype.SetValue=function(n,t){n.localName=="input"&&(n.type=="checkbox"||n.type=="radio")?n.checked=t:$(n).val(t)};n.DOMBuilder.prototype.FindElement=function(n){return ch.IsEmpty(n)?null:t.getElementById(n)};n.DOMBuilder.prototype.GetContents=function(n){return n.innerHTML};n.DOMBuilder.prototype.SetContents=function(n,t){n.nodeName=="#text"?n.nodeValue=t:n.innerHTML=t};n.DOMBuilder.prototype.AppendChild=function(n,t,i){var r=n.ownerDocument.createElement(t);return i&&i(r),n.appendChild(r),r};n.DOMBuilder.prototype.InsertBefore=function(n,t){var i=n.ownerDocument.createElement(t);return n.parentNode.insertBefore(i,n),i};n.DOMBuilder.prototype.InsertAfter=function(n,t){return i(n,n.ownerDocument.createElement(t))};n.DOMBuilder.prototype.MoveElement=function(n,t){return n.parentElement.removeChild(n),t.appendChild(n),n};n.DOMBuilder.prototype.AppendText=function(n,t){var i=n.ownerDocument.createTextNode(t);return n.appendChild(i),i};n.DOMBuilder.prototype.RenderText=function(n,t,i,r){return n?(this.SetContents(n,r),n):t&&i?this.InsertTextBefore(i,r):i?this.AppendText(i,r):void 0};n.DOMBuilder.prototype.InsertTextBefore=function(n,t){var i=n.ownerDocument.createTextNode(t);return n.parentNode.insertBefore(i,n),i};n.DOMBuilder.prototype.InsertTextAfter=function(n,t){return i(n,n.ownerDocument.createTextNode(t))};n.DOMBuilder.prototype.RemoveChild=function(n,t){n.removeChild(t)};n.DOMBuilder.prototype.RemoveFromParent=function(n){n.parentElement?n.parentElement.removeChild(n):n.parentNode&&n.parentNode.removeChild(n)};n.DOMBuilder.prototype.ShowElement=function(n,t){t?$(n).show():$(n).hide()};n.DOMBuilder.prototype.GetAttribute=function(n,t,i){var r=n.getAttribute(t);return r&&i&&this.RemoveAttribute(n,t),r};n.DOMBuilder.prototype.SetAttribute=function(n,t,i){n.setAttribute(t,i)};n.DOMBuilder.prototype.RemoveAttribute=function(n,t){n.removeAttribute(t)};n.DOMBuilder.prototype.InnerHTML=function(n,t){return t!=undefined?n.innerHTML=t:n.innerHTML};n.DOMBuilder.prototype.InnerText=function(n,t){return t!=undefined?n.innerText=t:$.trim(n.innerText)};n.DOMBuilder.prototype.AppendHtml=function(n,t){$(n).append(t)};n.DOMBuilder.prototype.LastChild=function(n){return n&&n.childNodes&&n.childNodes.length>0?n.childNodes[n.childNodes.length-1]:null};n.DOMBuilder.prototype.ElementsByName=function(n){return t.getElementsByTagName(n)};n.DOMBuilder.prototype.ProcessElementsByName=function(n,i,r){var o=t.getElementsByTagName(n),u=o.length,f,e;if(u>0){for(f=0;f<u;++f)i(o[f]);if(r)for(e=u-1;e>=0;--e)this.RemoveFromParent(o[e])}return u};n.DOMBuilder.prototype.ProcessElementsByQuery=function(n,t){var i=$(n);return i.each(function(){t(this)}),i.length};n.DOMBuilder.prototype.FirstElementByName=function(n){var i=t.getElementsByTagName(n);return i.length>0?i[0]:undefined};n.DOMBuilder.prototype.EndElement=function(){};n.DOMBuilder.prototype.css=function(n,t,i){$(n).css(t,i)};n.DOMStringBuilder=function(){this.sb=new n.StringBuilder;this.tags=[];this.currentTagEnded=!0};n.DOMStringBuilder.prototype.Clear=function(){this.sb.Clear();this.tags=[];this.currentTagEnded=!0};n.DOMStringBuilder.prototype.ToString=function(){return this.sb.ToString("")};n.DOMStringBuilder.prototype.FinishStartTag=function(){this.currentTagEnded||(this.sb.Append(">"),this.currentTagEnded=!0)};n.DOMStringBuilder.prototype.AppendChild=function(n,t,i){this.FinishStartTag();this.sb.Append("<"+t);this.tags.push(t);this.currentTagEnded=!1;i&&i(null)};n.DOMStringBuilder.prototype.EndElement=function(){var n=this.tags.pop();this.FinishStartTag();this.sb.Append("<\/"+n+">")};n.DOMStringBuilder.prototype.InsertBefore=function(n,t){this.AppendChild(n,t)};n.DOMStringBuilder.prototype.AppendText=function(n,t){this.FinishStartTag();this.sb.Append(t)};n.DOMStringBuilder.prototype.RenderText=function(n,t,i,r){this.AppendText(null,r)};n.DOMStringBuilder.prototype.InsertTextBefore=function(n,t){this.AppendText(null,t)};n.DOMStringBuilder.prototype.SetContents=function(n,t){this.AppendText(null,t)};n.DOMStringBuilder.prototype.SetAttribute=function(n,t,i){this.sb.Append(" "+t+'="'+i+'"')};n.DOMStringBuilder.prototype.InnerHTML=function(n,t){t&&this.AppendText(null,t)};n.DOMStringBuilder.prototype.InnerText=function(n,t){t&&this.AppendText(null,t)}}(Cheetah,document);!function(n){function r(n){this._output=[];this._delimiterStack=[];this._paramStack=[];this._injected=n}var t={KnownLibraries:{Math:!0,jQuery:!0,ch:!0,String:!0,Number:!0},TransformOperators:{and:"&&",or:"||"},EncodedTransformOperators:["&gt;","&lt;","&amp;","&quot;","&apos;"],EncodedTransformTo:[">","<","&",'"',"'"],Operators:["[","]","*","/","++","--","+=","-=","*=","/=","+","-","%","<","<=",">",">=","==","===","!=","!==","!","||","&&","?",":","(",")","~","^",">>","<<",",","=>","=:","and","or","="],LiteralValues:{xNaN:!0,xundefined:!0,xnull:!0,xtrue:!0,xfalse:!0},dOperators:null},i;n.IsExpressionText=function(n){return t.Operators.IfAny(function(t){return n.indexOf(t)!=-1})};t.IsOperator=function(n){return t.dOperators[n]};t.IsLiteralValue=function(n){return t.LiteralValues["x"+n]};n.Expression=function(i,r){var f=null,e=!0,o=i,h=r,s,u;this.ModelTokens=[];this.VarTokens=[];this.Eval=function(t,i,r){try{var u=f;return(i=ch.Coalesce(i,t.Model),e)?(r||(r={}),r.$$root=o.Model,r.$$scope=i,u(o,i,r,t)):i[u]}catch(s){return s.description.indexOf("undefined or null reference")==-1&&n.Logger.Error(s.description),""}};t.dOperators==null&&(t.dOperators=t.Operators.ToDictionary());s=new t.Compiler;u=s.Compile(r,this.ModelTokens,this.VarTokens,{$$root:1,$$result:1,$$target:1,$$value:1,$$scope:1});u.indexOf("return")==0?f=new Function("__vm","__model","__injected","__ec",u):(f=u,e=!1)};t.Compiler=function(){this._sb=[];this._tokenType=0;this._token=""};t.Compiler.prototype.PushToken=function(n,i){if(i==undefined&&(i=this._tokenType>1),n==undefined&&(n=this._token),!ch.IsEmpty(n)){var r=null;t.Operators.IfAny(function(t){return n.indexOf(t)==0?(r=t,!0):!1})&&n!=r?(this._sb.push(r),this._sb.push(n.substr(r.length))):this._sb.push(n)}this._token="";this._tokenType=0};i={Text:1,Literal:2,Number:3,Punctuation:4};t.Compiler.prototype.Compile=function(n,u,f,e){function y(n){return n>="0"&&n<="9"?!0:n=="."||n=="-"}for(var o,h,l,a,v=n.length,c=null,s=0;s<v;++s)o=n[s],o=="'"&&c!="\\"?this._tokenType==i.Literal?this.PushToken(this._token+o,!0):(this.PushToken(),this._tokenType=i.Literal,this._token=String(o)):this._tokenType==i.Literal?this._token+=o:o==" "?this.PushToken():y(o)?this._tokenType==i.Number||this._tokenType==i.Text?this._token+=o:(this.PushToken(),this._token=String(o),this._tokenType=i.Number):/[!=<>\|&/\*\^\+\~\?\:]/.test(o)?(o=="&"&&(h=0,t.EncodedTransformOperators.ForEach(function(i){var r=n.substr(s,i.length);return r==i?(s+=i.length-1,o=t.EncodedTransformTo[h],!1):(++h,!0)},!0)),this._tokenType==i.Punctuation?this._token+=o:(this.PushToken(),this._token=String(o),this._tokenType=i.Punctuation)):/[{}:;\(\)?\]\[+,]/.test(o)?(this.PushToken(),this.PushToken(o,!0)):(this._token+=String(o),this._tokenType=i.Text),c=o;return this.PushToken(),l=new r(e),a=l.Resolve(this._sb,u,f),"return "+a+";"};r.prototype.Resolve=function(n,i,r){var s=this,u=this._output,e=this._paramStack,f=this._delimiterStack,h=this._injected,o=!1;return n.ForEach(function(n){var i,l,a,c,v;if(n=="=>"||n=="=:"){if(f.push(n),e.push("()"),o=!0,i=u.pop().replace("__model.",""),l="function (",i==")"){for(a=[];;){if(i=u.pop(),i=="(")break;i=i.replace("__model.","");i!=","&&(e.push(i),a.push(i))}l+=a.reverse().Pack(", ")}else e.push(i),l+=i;u.push(l+") { return ")}else n=="("||n=="["?(u.push(n),f.push(n)):n=="]"?(u.push(n),f.pop()):n==")"||n==","?(s.CheckLambda(),u.push(n),n==")"&&f.pop()):n=="("||n=="["?(t.IsOperator(u.peek())||(o=!0),u.push(n),f.push(n)):t.TransformOperators[n]?u.push(" "+t.TransformOperators[n]+" "):n.indexOf("'")==0||n.indexOf('"')==0?u.push(n):t.IsLiteralValue(n)?u.push(n):isNaN(parseFloat(n))?t.IsOperator(n)?u.push(n):(c=n.FirstInList("."),c.indexOf("$$")==0?h[c]?u.push("__injected."+n):u.push("__model."+n):c.indexOf("$")==0?(v=c.substr(1),u.push("__ec.GetVar('"+v+"')"+n.substr(c.length)),r.push(v)):c==""||t.KnownLibraries[c]?u.push(n):c=="this"?u.push(n.replace("this.","__vm.")):s.IsLambdaParam(c)?u.push(n):u.push("__model."+n)):u.push(n)}),u.ForEach(function(n){n.indexOf("__model.")==0?i.push(n.substr(8)):n.indexOf("__injected.$$")==0&&i.push(n.substr(11))}),o&&i.push("__expr__"),this._output.Pack("")};r.prototype.CheckLambda=function(){var t=this._delimiterStack.peek(),n;if(t=="=>"||t=="=:")for(this._output.push("; }"),this._delimiterStack.pop(),n=this._paramStack.pop();n!="()";)n=this._paramStack.pop()};r.prototype.IsLambdaParam=function(n){for(var i,r=this._paramStack.length,t=r-1;t>=0;--t)if(i=this._paramStack[t],i==n)return!0;return!1}}(Cheetah,document);!function(n){function t(n){var t={Speed:ch.FindValue(n,"speed","fast"),Select:ch.FindValue(n,"select")};return n.ForEach(function(n){n.localName!="select"&&n.localName!="speed"&&n.localName!="if"&&(t[n.localName]=n.value)}),t}function i(n,t,i,r){var f=null,e,u;if(ch.IsEmpty(i.Select)?ch.IsValid(t)?f=$(t):n&&(f=$(ch.EventTarget(n))):f=ch.SelectTarget(n,i.Select),f){e={};for(u in i)u.toLowerCase()!="select"&&u.toLowerCase()!="speed"&&u!="if"&&(e[u]=i[u]);r(f,e)}}var r=new function(){this.Name="fadein";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.fadeIn(u.Speed,f)})};n.RegisterActionStep(this)},u=new function(){this.Name="fadeout";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.fadeOut(u.Speed,f)})};n.RegisterActionStep(this)},f=new function(){this.Name="slidedown";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.slideDown(u.Speed,f)})};n.RegisterActionStep(this)},e=new function(){this.Name="slideup";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.slideUp(u.Speed,f)})};n.RegisterActionStep(this)},o=new function(){this.Name="animate";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n,t){n.animate(t,u.Speed,f)})};n.RegisterActionStep(this)}}(Cheetah,document);!function(n){function t(t,i,r){t.Name=i;t._storage=r;t.ProcessAttributes=function(n){return{Name:ch.FindValue(n,"name"),Value:ch.FindValue(n,"value")}};t.Run=function(n,i,r,u){t._storage.SetValue(u.Name,u.Value)};n.RegisterActionStep(t)}function i(t,i,r){t.Name=i;t._storage=r;t.AllowChildren=!0;t.ProcessAttributes=function(n){var t={Required:"none",OnlyOne:!0,Items:[]};return n.ForEach(function(n){switch(n.localName){case"name":t.Items.push({Name:n.value,Type:"string"});break;case"required":t.Required=n.value;break;default:t.OnlyOne=!1;t.Items.push({Name:n.localName.toLowerCase(),Type:n.value.toLowerCase()})}}),t};t.Run=function(n,i,r,u,f){var e=0,o=u.Required=="all"?u.Items.length:0,s=u.Required=="all"||u.Required=="none"?null:u.Required.split(",");s&&(o=s.length);n.$$result||(n.$$result={});u.Items.ForEach(function(i){var r=t._storage.GetValue(i.Name);if(r){++e;try{switch(i.Type){case"number":r=Number(r);break;case"date":r=new Date(r)}}catch(f){}u.OnlyOne?n.$$result=r:n.$$result[i.Name]=r}});f&&e>=o&&f()};n.RegisterActionStep(t)}var r=new function(){t(this,"sessionsetter",n.Session)},u=new function(){i(this,"sessiongetter",n.Session)},f=new function(){t(this,"storagesetter",n.Storage)},e=new function(){i(this,"storagegetter",n.Storage)},o=new function(){t(this,"cookiesetter",n.Cookie)},s=new function(){i(this,"cookiegetter",n.Cookie)}}(Cheetah,document);!function(n){function t(t,i,r){t.Name=i;t.Verb=r;t.AllowChildren=!0;t.ProcessAttributes=function(t,i){for(var u,r={},e=t.length,f=0;f<e;++f)u=t[f],u.name!="if"&&(r[u.name]=u.value);return!r.url&&i&&(r.url=n.Builder.InnerText(i)),r};t.Run=function(i,r,u,f,e,o){var s=u.CreateService(),c=s.NormalizeUrl(f.url),h;f=ch.Clone(f);delete f.url;f.params&&typeof f.params=="object"&&(h=ch.Clone(f.params),delete f.params,f=ch.Merge(h,f));s.Query(c,t.Verb,f,function(n){i.$$result=n;e&&e()},function(t){o?(i.$$result=t,o()):n.Logger.Error(t)})};n.RegisterActionStep(t)}var i=new function(){t(this,"serviceget","GET")},r=new function(){t(this,"servicepost","POST")},u=new function(){t(this,"serviceput","PUT")},f=new function(){t(this,"servicedelete","DELETE")}}(Cheetah,document);
//# sourceMappingURL=cheetah.min.js.map
