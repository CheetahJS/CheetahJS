/*****************************************************************************/
/*                                                                           */
/*    CheetahJS - "Because it's fast!"                                       */
/*                                                                           */
/*       An MVVM Javascript Library for fast web development                 */
/*                                                                           */
/*   Copyright (c) 2015-2016 - Jim Lightfoot                                 */
/*                                                                           */
/*      This software is available under the MIT license (MIT)               */
/*                                                                           */
/*****************************************************************************/"use strict";var ch=new function(){function t(n,t,i){return n.replace("{"+i+"}",t)}var n=function(n){Cheetah&&Cheetah.Logger?Cheetah.Logger.Error(n):console.error(n)};this.GetBindData=function(n,t){var u,i,r;if(typeof n!="string")return n;for(u=n.split("."),i=0;i<u.length;++i)r=u[i],t=r.indexOf("[")==0?t[Number(r.substr(1))]:t[r];return t};this.GetModelValue=function(t,i,r){var e=i,o,s,f,h,u;if(typeof i=="string"&&(e=i.split(".")),o=e.length,o!=0){if(s=e[0],s.indexOf("$")==0&&s.indexOf("$$")==-1){if(!r){n("Found variable in expression but no variable container was passed.");return}if(f=r.GetVar(s.substr(1)),!f){n("Variable container does not contain variable in expression.");return}return(s=="$bind"&&typeof f=="string"&&(f=t[f]),o==1)?f:this.GetModelValue(f,e.slice(1))}for(--o,h=0;h<o;++h)if(u=e[h],u.indexOf("[")==0)t=t[Number(u.substr(1))];else if(u=="$$parent"){if(!t.$$parent){n("$$parent is not valid");return}t=t.$$parent}else t=t[u];return(u=e[o],u.indexOf("[")==0)?t[Number(u.substr(1))]:t[u]}};this.SetModelValue=function(t,i,r){for(var u,f=i.split("."),o=f.length-1,e=0;e<o;++e)if(u=f[e],u=="$$parent"){if(!ch.IsValid(t.$$parent)){n("$$parent is not valid");return}t=t.$$parent}else t[u]||(t[u]={}),t=t[u];t[f[o]]=r};this.ElementData=function(n,t){return n?(n.delegateTarget!=undefined&&(n=n.delegateTarget),t==undefined)?$(n).data():$(n).data(t):null};this.EventTarget=function(n){return n?n.delegateTarget?n.delegateTarget:n.target:null};this.SelectTarget=function(n,t){var i=ch.EventTarget(n),r;if(!ch.IsEmpty(t)){for(r=!1;t.length>0;){if(t.indexOf("$self")==0&&(r=!0,t=t.substr(5),t.indexOf(".")==0&&(t=t.substr(1))),t.indexOf("$parent")==0){r=!0;t=t.substr(7);i=i.parentElement;t.indexOf(".")==0&&(t=t.substr(1));continue}break}return r?ch.IsEmpty(t)?$(i):$(i).find(t):$(t)}return $(i)};this.IsValid=function(n){return n!=undefined&&n!=null};this.CopyAttributes=function(n,t){t.ForEach(function(t){n.setAttribute(t.Name,t.Value)})};this.Evaluate=function(n,t,i){return typeof n=="string"?n:n.Evaluate?n.Evaluate(t,i):n};this.Format=function(){var r=Array.prototype.slice.apply(arguments),u=r.length,i,n;if(u==0)return"";if(i=r[0],u>1)for(n=1;n<u;++n)i=t(i,r[n],n-1);return i};this.IsEmpty=function(n){return ch.IsValid(n)?typeof n=="string"?$.trim(n).length==0:n.length!=undefined?n.length==0:!1:!0};this.IsValidNumber=function(n){return ch.IsValid(n)&&!isNaN(n)};this.Sanitize=function(n,t){if(!n||typeof n!="object")return n;if(n.length!=undefined){n.ForEach(function(n){ch.Sanitize(n)});return}for(var i in n)i.indexOf("$$")==0?delete n[i]:t||this.Sanitize(n[i]);return n};this.Merge=function(n,t){for(var i in t)n[i]=t[i];return n};this.Clone=function(n,t){var r,u,i;if(!n||typeof n!="object")return n;if(t==undefined&&(t=!1),n.length!=undefined){for(r=[],i=0;i<n.length;++i)r[i]=t?n[i]:ch.Clone(n[i]);return r}u={};for(i in n)i.indexOf("$$")==-1&&(u[i]=t?n[i]:ch.Clone(n[i]));return u};this.ShallowClone=function(n){return this.Clone(n,!0)};this.Convert=function(n){var t,i;return ch.IsValid(n)?typeof n!="string"?n:n.length==0?n:(t=$.trim(n.toLowerCase()),t=="true")?!0:t=="false"?!1:(i=parseFloat(t),!isNaN(i))?i:(n=$.trim(n),n.indexOf('"')==0&&n.lastIndexOf('"')==n.length-1?n=n.substr(1,n.length-2):n.indexOf("'")==0&&n.lastIndexOf("'")==n.length-1&&(n=n.substr(1,n.length-2)),n):n};this.IsNonZero=function(n){return ch.IsValidNumber(n)&&n!=0};this.IsZero=function(n){return!ch.IsValidNumber(n)||n==0};this.Coalesce=function(n,t,i,r){return ch.IsValid(n)?n:ch.IsValid(t)?t:ch.IsValid(i)?i:r};this.Redirect=function(n){document.location.href=n};this.GetValue=function(n){var t=n.localName;return t=="select"?n.options[n.selectedIndex].value:n.value};this.SetValue=function(n,t){var r,i,u;if(n.localName=="select"){for(r=n.options.length,i=0;i<r;++i)if(u=n.options[i].value,t==u){n.selectedIndex=i;break}}else n.value=t};this.Do=function(n){n&&n()};this.AttributeValue=function(t,i,r){var u,f;if(!t)return null;if(t.attributes){if(u=t.attributes[i],r&&(!u||ch.IsEmpty(u.value)))return n("Missing '"+i+"' attribute for '"+t.localName+"' element"),null;if(u)return $.trim(u.value)}else if(t.length!=undefined&&!t.nodeName&&(f=t.FindMatching(function(n){return n.Name==i}),f))return $.trim(f.Value);return null};this.NormalizeText=function(n){return ch.IsValid(n)?n:""};this.FindValue=function(n,t,i){var r=n.FindMatching(function(n){return n.localName==t});return r==null?i!=undefined?i:"":r.value};this.Sort=function(n,t){function f(n){var i,t;for(this.Attr="",this.Asc=!0,this.Num=!1,i=$.trim(n).replaceAll("  "," ").split(" "),this.Attr=i[0],t=1;t<=2;++t)if(i.length>t)i[t]=="desc"?this.Asc=!1:i[t]=="number"&&(this.Num=!0);else break;this.Run=function(n,t){var i=n[this.Attr],r=t[this.Attr],u=this.Asc?-1:1,f=this.Asc?1:-1;return!ch.IsValid(i)&&!ch.IsValid(r)?0:ch.IsValid(i)?ch.IsValid(r)?(this.Num&&(i=Number(i),r=Number(r)),i==r)?0:i<r?u:f:f:u}}var i=t.split(","),u=i.length,r=[];i.ForEach(function(n){r.push(new f(n))});n.sort(function(n,t){for(var f,i=0;i<u;++i)if(f=r[i].Run(n,t),f!=0)return f;return 0})}},Cheetah;!function(){function t(n,t,i){var u,r,f;for(i==undefined&&(i=!1),u=n.length,r=0;r<u;++r)if(f=t(n[r]),i&&!f)break;return u>0}function n(n,t){for(var i,u=n.length,r=0;r<u;++r)if(i=n[r],t(i))return typeof i=="object"&&(i.$matchingIndex=r),i;return null}NodeList.prototype.ForEach=function(n,i){return t(this,n,i)};NamedNodeMap.prototype.ForEach=function(n,i){return t(this,n,i)};Array.prototype.ForEach=function(n,i){return t(this,n,i)};Array.prototype.ToDictionary=function(n){var t={};return this.ForEach(function(i){var r=n(i);t[r]=i}),t};Array.prototype.Reduce=function(n,t){for(var i=t,u=this.length,r=0;r<u;++r)i=n(i,this[r]);return i};Array.prototype.ShallowCopy=function(){for(var t=[],i=this.length,n=0;n<i;++n)t.push(this[n]);return t};Array.prototype.Pack=function(n,t){return ch.IsValid(t)?this.Reduce(function(i,r){var u=t(r);return i==""?u:i+n+u},""):this.join(n)};Array.prototype.Append=function(n){for(var i=n.length,t=0;t<i;++t)this.push(n[t])};Array.prototype.FindMatching=function(t){return n(this,t)};Array.prototype.Remove=function(t){var i=n(this,t);return i?this.splice(i.$matchingIndex,1):null};NodeList.prototype.FindMatching=function(t){return n(this,t)};NamedNodeMap.prototype.FindMatching=function(t){return n(this,t)};Array.prototype.IfAny=function(n){return this.FindMatching(n)!=null};Array.prototype.IfNotAny=function(n){for(var i=this.length,t=0;t<i;++t)if(!n(this[t]))return!0;return!1};Array.prototype.IfAll=function(n){return!this.IfNotAny(n)};String.prototype.FirstInList=function(n){return!n||this.indexOf(n)==-1?this:this.substr(0,this.indexOf(n))};String.prototype.EndsWith=function(n){if(n==undefined||n==null||this==undefined||this==null)return!1;var t=this.length,i=n.length;return t<i?!1:this.lastIndexOf(n)==t-i};String.prototype.EnsureEndsWith=function(n){return this.EndsWith(n)?this:this+n};String.prototype.replaceAll=function(n,t){return this.replace(new RegExp(n.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),t)};String.prototype.StripAfter=function(n){var t=this.indexOf(n);return t!=-1?this.substr(0,t+n.length):this};String.prototype.StripBefore=function(n){var t=this.indexOf(n);return t!=-1?this.substr(t):this};String.prototype.TrimBefore=function(n){var t=this.indexOf(n);return t>0?this.substr(t):this};String.prototype.TrimBeforeIncluding=function(n){var t=this.indexOf(n);return t>0?this.substr(t+n.length):this};String.prototype.TrimAfter=function(n){var t=this.indexOf(n);return t>=0?this.substr(0,t+n.length):this};String.prototype.TrimAfterIncluding=function(n){var t=this.indexOf(n);return t>=0?this.substr(0,t):this};Number.prototype.PadLeft=function(n,t){var i=String(this);for(t||(t="0");i.length<n;)i=t+i;return i};Function.prototype.inherits=function(n){return n.constructor==Function?(this.prototype=new n,this.prototype.constructor=this,this.prototype.parent=n.prototype):(this.prototype=n,this.prototype.constructor=this,this.prototype.parent=n),this}}();Cheetah=Cheetah||{};Cheetah.StartDelimiter="//";Cheetah.EndDelimiter="//";Cheetah.Builder=null;Cheetah.Logger=null;!function(n,t){function u(n,t){var i=ch.AttributeValue(t,"if");return ch.IsEmpty(i)?null:n.CreateCondition(i)}function r(n,t,i){if(n==null)return!0;var r=ch.Coalesce(t.$model,i.Model);return n.Eval(i,r)}var i={Templates:{},Actions:{},Prerequisites:[],Transforms:{},ActionSteps:{},Priority:{Default:0,High:100}},f;n.ViewModel=function(t){this.Model=null;this.ModelPath="";this.ModelVerb="GET";this.Template="";var r=new i.ViewModel(this,t);this.LoadRouteTable=function(n,t,i){r.LoadRouteTable(n,t,i)};this.HaveRoutes=function(){return!ch.IsEmpty(r.Routes)};this.LoadModel=function(n,t){r.LoadModel(n,t)};this.GetModel=function(n,t){r.GetModel(n,t)};this.ProcessModel=function(n,t){r.ProcessModel(n,t)};this.PreProcessModel=function(){};this.PostProcessModel=function(){};this.Sync=function(n,t){r.Sync(n,t)};this.OnError=function(n){alert(n)};this.OnInfo=function(n){alert(n)};this.Confirm=function(n,t){confirm(n)&&t()};this.CreateService=function(){return new n.Service("")};this.UpdateView=function(){r.UpdateView()}};n.RegisterTransform=function(t){ch.IsEmpty(t.Name)?n.Logger.Error("Transform missing name"):ch.IsEmpty(t.NewName)&&ch.IsEmpty(t.UseTemplate)&&ch.IsEmpty(t.RequiredParent)?n.Logger.Error("Transform missing new name"):i.Transforms[t.Name]?n.Logger.Error("A transform with the name of '"+t.Name+"' has already been registered"):i.Transforms[t.Name]=t};n.RegisterActionStep=function(t){ch.IsEmpty(t.Name)?n.Logger.Error("Custom action step missing name"):t.Run?i.ActionSteps[t.Name]?n.Logger.Warning("A custom action step with the name of '"+t.Name+"' has already been registered"):i.ActionSteps[t.Name.toLowerCase()]=t:n.Logger.Error("Custom action step missing Run method")};n.RegisterPrerequisite=function(n){i.Prerequisites.push(n)};!function(t){function i(){var n=ch.ShallowClone(t.Prerequisites);return n.IfAll(function(n){return n.IsMet})}t.ViewModel=function(i,r){this.Conditions={};this.Expressions={};this.Routes=null;this.FirstSubRoute=null;this.Synced=[];this.ActualViewModel=i;this.Container=r;this.Deferred=[];this.Async=[];this.Watchers=new t.WatcherList(this);this.ModelID=1;this.Updated=!1;this.SuppressUpdate=!1;var u=this.GetContainer();u&&(this.ActualViewModel.Template=n.Builder.InnerHTML(u),this.ActualViewModel.ModelPath=n.Builder.GetAttribute(u,"ch-model",!0))};t.ViewModel.prototype.GetContainer=function(){return this.Container=="body"?n.Builder.FirstElementByName("body"):n.Builder.FindElement(this.Container)};t.ViewModel.prototype.LoadModel=function(n,t){if(!ch.IsEmpty(this.ActualViewModel.ModelPath)){var i=this;this.GetModel(n,function(n){i.ProcessModel(n,t)})}};t.ViewModel.prototype.GetModel=function(n,t){var i=this;this.CreateService().LoadModel(this.ActualViewModel.ModelPath,this.ActualViewModel.ModelVerb,n,t,function(n){i.OnError(n)})};t.ViewModel.prototype.ProcessModel=function(r,u){var s,f,o,e;if(!i()){s=this;setTimeout(function(){s.ProcessModel(r,u)},10);return}this.ActualViewModel.Model=r;this.ModelID=1;this.PreProcessModel();f=this.GetContainer();f!=null&&(o=f.style.display,n.Builder.ShowElement(f,!1),n.Builder.InnerHTML(f,""),e=n.Builder.AppendChild(f,"div"),n.Builder.ShowElement(e,!1),n.Builder.InnerHTML(e,this.ActualViewModel.Template),this.Watchers=new t.WatcherList(this),this.Deferred=[],this.Async=[],this.RenderModel(e,f,this.ActualViewModel.Model),n.Builder.RemoveChild(f,e),f.style.display=o=="none"||o==""?"block":o,this.ProcessDeferred(),this.PostProcessModel(r),u&&u(r),this.ProcessAsync())};t.ViewModel.prototype.ProcessDeferred=function(){this.Deferred.ForEach(function(n){ch.Do(n)});this.Deferred=[]};t.ViewModel.prototype.ProcessAsync=function(){if(!ch.IsEmpty(this.Async)){var n=this;setTimeout(function(){n.Async.ForEach(function(n){ch.Do(n)});n.Async=[]},20)}};t.ViewModel.prototype.RenderModel=function(n,i,r){r.$$parent=null;var u=new t.DOMElement(this,null,n,r);u.NewElement=i;u.Render(n,r);return};t.ViewModel.prototype.LoadRouteTable=function(n,i,r){var u=this;this.CreateService().Get(n,function(n){n.Routes.ForEach(function(i){var r=new t.Route(u,i,ch.Coalesce(n.Defaults,{}));ch.IsValid(u.Routes)||(u.Routes={});u.Routes[i.Name]=r;u.FirstSubRoute==null&&(u.FirstSubRoute=r)});ch.Do(i);r&&u.FirstSubRoute&&u.FirstSubRoute.Run(null,!0)})};t.ViewModel.prototype.RunRoute=function(n,t,i){var r=this.Routes[n];ch.IsValid(r)&&r.Run(t,i)};t.ViewModel.prototype.PreProcessModel=function(){this.ActualViewModel.PreProcessModel()};t.ViewModel.prototype.PostProcessModel=function(n){this.ActualViewModel.PostProcessModel(n)};t.ViewModel.prototype.OnError=function(n){this.ActualViewModel.OnError(n)};t.ViewModel.prototype.OnInfo=function(n){this.ActualViewModel.OnInfo(n)};t.ViewModel.prototype.Confirm=function(n,t,i){this.ActualViewModel.Confirm(n,t,i)};t.ViewModel.prototype.CreateService=function(){return this.ActualViewModel.CreateService()};t.ViewModel.prototype.AddWatcher=function(n,t,i){this.Watchers.AddWatcher(n,t);var r=this;i&&this.Deferred.push(function(){n.Eval(r,!0)})};t.ViewModel.prototype.RemoveWatcher=function(n){this.Watchers.RemoveWatcher(n)};t.ViewModel.prototype.GetTransform=function(n){return _transforms[n]};t.ViewModel.prototype.UpdateView=function(){if(!this.Updated&&!this.SuppressUpdate){try{var i=this;this.Updated=!0;this.Watchers.UpdateView();this.Synced.ForEach(function(n){n.UpdateView()})}catch(t){n.Logger.Error(t.description)}this.Updated=!1}};t.ViewModel.prototype.Sync=function(n,t){this.Synced.push(n);t&&n.Sync(this,!1)};t.ViewModel.prototype.CreateCondition=function(t){var i=this.Conditions[t];return i==undefined&&(i=new n.Expression(this.ActualViewModel,t,!0),this.Conditions[t]=i),i};t.ViewModel.prototype.CreateExpression=function(t){var i=this.Expressions[t];return i==undefined&&(i=new n.Expression(this.ActualViewModel,t,!1),this.Expressions[t]=i),i};t.ViewModel.prototype.HandleClick=function(n,t,i){var r=this,u,f;if(t.indexOf("^")==0){if(u=n.FindAction(t.substr(1)),u!=null)return function(t){return t.$model=ch.Coalesce(t.$model,n.Model),t.$position=n.Position,!u.Run(t)&&i&&r.UpdateView(),!0}}else return f=r.ActualViewModel,function(u){return u.$model=ch.Coalesce(u.$model,n.Model),u.$position=n.Position,!f[t](u)&&i&&r.UpdateView(),!0}}}(i,t);i.WatcherList=function(n){this.ViewModel=n;this.Count=0;this.Watchers=[{},{}]};i.WatcherList.prototype.AddWatcher=function(n,t){t==undefined&&(t=i.Priority.Default);n.Id=String(++this.Count);var r=this.Watchers[t==i.Priority.High?0:1];r[n.Id]=n};i.WatcherList.prototype.RemoveWatcher=function(n){var t=n.Id;this.Watchers.ForEach(function(n){return ch.IsValid(n[t])?(delete n[t],!1):!0},!0)};i.WatcherList.prototype.UpdateView=function(){var t=this.ViewModel;this.Watchers.ForEach(function(i){var r=ch.ShallowClone(i);$.each(r,function(r,u){if(ch.IsValid(i[r]))try{u.Eval(t)}catch(f){n.Logger.Error(f.description)}})})};!function(t){function u(n){if(n.NewElement)return n.NewElement;var t=null;return n.Children.FindMatching(function(n){return t=u(n),t!=null}),t}function r(n){var t,i,f;return n.ParentContext?(t=n.Index,i=n.ParentContext.Children,t<i.length-1)?(f=i[t+1],u(f)):r(n.ParentContext):null}function i(){n.Logger.Error("Non Cheetah elements not allowed in a variable")}function f(n){this.Name=n;this.NewName=n;this.IsEditable=n=="input"||n=="select"||n=="textarea";this.IsIdentity=!0;this.IgnoreText=!1;this.GetValue=function(n){return $(n).val()};this.SetValue=function(n,t){$(n).val(t)};this.OnBind=function(n,t,i){var r="",u,f;switch(n.localName){case"select":r="change";break;case"textarea":r="keyup";break;case"input":switch(n.type){case"text":case"password":case"email":case"date":case"number":case"url":r="keyup";break;default:r="change"}}if(u=t.split(":"),u.length==2&&(r=$.trim(u[1])),r=="")throw"No known event type for this element";f=this;$(n).on(r,function(n){var t=f.GetValue(ch.EventTarget(n));i(t)})}}t.Node=function(t,i,r,u){this.ParentContext=i;this.ViewModel=t;this.Element=r;this.NewElement=null;this.Model=u;this.Watchers=[];this.Index=0;this.PreserveSpace=i?i.PreserveSpace:!1;this.Watch=!0;this.Builder=i?i.Builder:n.Builder;i&&(i.Children.push(this),this.Watch=i.Watch);var f=ch.AttributeValue(r,"ch-watch");ch.IsEmpty(f)||(this.Watch=ch.Evaluate(this.EvaluateText(t,f))=="true")};t.Node.prototype.Clear=function(){};t.Node.prototype.EvaluateText=function(n,i){return i==null||i==undefined?"":t.IsCheetahExpression(i)?new t.TextExpression(n,this,i):$.trim(i)};t.Node.prototype.ProcessElement=function(){};t.Node.prototype.GetVar=function(n){return this.ParentContext?this.ParentContext.GetVar(n):null};t.Node.prototype.OnChange=function(){this.ParentContext&&this.ParentContext.OnChange()};t.Node.prototype.AddWatcher=function(n,t,i,r){this.Watchers.push(t);n.AddWatcher(t,i,r)};t.TextNode=function(n,i,r,u){if(t.Node.call(this,n,i,r,u),n){var f=r.nodeValue;this.Expression=this.EvaluateText(n,f);this.Watch&&typeof this.Expression!="string"&&this.Expression.Expressions.length>0&&this.AddWatcher(n,new t.TextNodeWatcher(n,this,this.Expression))}};t.TextNode.inherits(t.Node);t.TextNode.prototype.Clear=function(n){n&&this.NewElement&&(this.Builder.RemoveFromParent(this.NewElement),this.NewElement=null)};t.TextNode.prototype.RenderText=function(n,t,i){this.NewElement=this.Builder.RenderText(this.NewElement,n,t,i);this.NewElement&&(this.NewElement.$context=this)};t.TextNode.prototype.ProcessElement=function(n,t){var i=ch.Evaluate(this.Expression);this.PreserveSpace||(i=$.trim(i));this.RenderText(n,t,i)};t.TextNode.prototype.Render=function(n,t){return ch.IsValid(t)?(this.Model=t,this.ProcessElement(),!0):!1};t.VariableTextNode=function(n,i,r,u,f){t.TextNode.call(this,n,i,r,u);this.VariableElement=f};t.VariableTextNode.inherits(t.TextNode);t.VariableTextNode.prototype.ProcessElement=function(){var n=ch.Evaluate(this.Expression);typeof n=="string"&&(n=$.trim(ch.NormalizeText(n)));this.VariableElement.ParentContext.SetVar(this.VariableElement.VariableName,n)};t.Element=function(n,i,r,u){t.Node.call(this,n,i,r,u);this.Children=[];this.Variables={};this.Actions={};this.Name="";this.TransformInstance={};this.InTransform=i!=null?i.InTransform:null;this.OnRender=null;this.IsCheetahElement=!1;this.IgnoreText=!1;this.ResolveTransformInstance()};t.Element.inherits(t.Node);t.Element.prototype.GetNonCheetahAncestor=function(){for(var n=this.ParentContext;n!=null;){if(!n.IsCheetahElement&&n.Name.indexOf("ch-")==-1)return n;n=n.ParentContext}return null};t.Element.prototype.GetVar=function(n){return ch.IsValid(this.Variables[n])?this.Variables[n]:this.ParentContext?this.ParentContext.GetVar(n):null};t.Element.prototype.SetVar=function(n,t){this.Variables[n]=t};t.Element.prototype.CreateChild=function(i,r){var u=i.localName;if(u=="ch-else"||u=="ch-elseif"){if(this.LastIf){if(u=="ch-elseif")return this.LastIf.AddElseIf(i),null}else t.LogError(u=="ch-else"?2:0);return this.LastIf.AddElse(i),this.ProcessLastIf(),null}this.ProcessLastIf();try{switch(u){case"ch-bind":return new t.BindElement(r,this,i,this.Model);case"ch-if":return this.LastIf=new t.IfElement(r,this,i,this.Model),null;case"ch-action":return this.CreateAction(i),null;case"ch-variable":return new t.Variable(r,this,i,this.Model),null;default:return new t.DOMElement(r,this,i,this.Model)}}catch(f){return n.Logger.Error(f.description),null}};t.Element.prototype.Render=function(n,t,i,r){if(!ch.IsValid(t))return!1;var u=this,f=u.ViewModel;return t.$$id=f.ModelID++,t.$$index=-1,this.ProcessChildren(r),!0};t.Element.prototype.ResolveTransformInstance=function(){this.TransformInstance.$name=this.Name;this.TransformInstance.$parent=this.ParentContext?this.ParentContext.TransformInstance:null;this.TransformInstance.GetAncestor||(this.TransformInstance.GetAncestor=function(n){for(var t=this;t!=null;){if(t.$name==n)return t;t=t.$parent}return null})};t.Element.prototype.Clear=function(n,t){var i=this.ViewModel;t&&(this.Watchers.ForEach(function(n){i.RemoveWatcher(n)}),this.Watchers=[]);this.Children.ForEach(function(n){n.Clear(!0,!0)});this.NewElement!=null&&(n?(this.Builder.RemoveFromParent(this.NewElement),this.NewElement=null):this.Builder.SetContents(this.NewElement,""));this.Children=[]};t.ErrorMessages=["'ch-elseif' statement does not follow a 'ch-if' statement","An element with a 'ch-elseif' attribute does not follow an element with a 'ch-if' attribute","'ch-else' statement does not follow a 'ch-if' or 'ch-elseif' statement","An element with a 'ch-else' attribute does not follow an element with a 'ch-if' or 'ch-elseif' attribute","An action with the name '{0}' was not found!","Neither 'select' nor 'select-data' is specified for an action setter","'name' attribute missing on action setter","'select' attribute missing on action setter"];t.LogError=function(i){n.Logger.Error(t.ErrorMessages[i])};t.Element.prototype.FindAction=function(i){if(this.Actions[i])return this.Actions[i];if(this.ParentContext)return this.ParentContext.FindAction(i);if(t.Actions[i]){var r=new t.Action(this.ViewModel,this,t.Actions[i]);return this.AddAction(r),r}return n.Logger.Error(t.ErrorMessages[4].replace("{0}",i)),null};t.Element.prototype.AddAction=function(n){this.Actions[n.Name]=n};t.Element.prototype.ProcessElement=function(){this.ProcessChildren()};t.Element.prototype.ProcessChildren=function(n,i){var u=this,f=null,e=0,o=this.Template!=null?this.Template.childNodes:this.Element.childNodes;n&&!i&&(i=r(this));i||(i=this.NewElement?this.NewElement:this.GetRenderParent(),n=!1);o.ForEach(function(r){if(r.nodeName=="#text"){if(!u.IgnoreText&&$.trim(r.nodeValue)!=""){var o=null;o=u.Builder.CreateTextNode?u.Builder.CreateTextNode(u.ViewModel,u,r,u.Model):new t.TextNode(u.ViewModel,u,r,u.Model);o.ProcessElement(n,i);++e}}else{if(f=u.CreateChild(r,u.ViewModel),f==null)return;f.ProcessElement(n,i);f.PostProcess();f.Index=e;++e}});return};t.Element.prototype.CreateAction=function(n){var r=new t.Action(this.ViewModel,this,n),u,i;if(ch.IsEmpty(r.Name))if(u=this.Name,i=r.Trigger,ch.IsEmpty(i)&&(i=u=="button"||u=="a"?"click":"mouseup"),i.indexOf("visibility")==-1&&i.indexOf("visible")==-1)$(this.NewElement).on(i,function(n){r.Run(n)});else ch.IsValid(this.VisibilityWatcher)&&(i.indexOf("true")!=-1?this.VisibilityWatcher.ShowAction=r:this.VisibilityWatcher.HideAction=r);else this.AddAction(r);return};t.Element.prototype.ProcessLastIf=function(){this.LastIf&&(this.LastIf.ProcessElement(),this.LastIf.PostProcess(),this.LastIf=null)};t.Element.prototype.PostProcess=function(){this.ProcessLastIf();this.OnRender&&this.OnRender(this)};t.Element.prototype.GetRenderParent=function(){for(var n=null,t=this.ParentContext;!n&&t;)n=t.NewElement,t=t.ParentContext;return n==null&&(n=this.Builder.FindElement(this.ViewModel.Container)),n};t.CheetahElement=function(n,i,r,u){t.Element.call(this,n,i,r,u);this.IsCheetahElement=!0;var f=ch.AttributeValue(r,"preserve-space");ch.IsEmpty(f)||(this.PreserveSpace=f.toLowerCase()=="true")};t.CheetahElement.inherits(t.Element);t.IfElement=function(n,i,r,u){t.CheetahElement.call(this,n,i,r,u);this.If=r;this.Else=null;this.ElseIf=[];this.RenderedIndex=-1;this.Watcher=null;var f=ch.AttributeValue(r,"test",!0);if(ch.IsEmpty(f))throw"Missing 'test' attribute for ch-if";this.Condition=n.CreateCondition(f);this.Watch&&(this.Watcher=new t.IfWatcher(n,this),this.AddWatcher(n,this.Watcher))};t.IfElement.inherits(t.CheetahElement);t.IfElement.prototype.Clear=function(n,t){t&&(this.Watcher=null);this.parent.Clear.call(this,n,t)};t.IfElement.prototype.FindBlock=function(n){if(this.Condition.Eval(this)){n(this.If,0);return}if(this.ElseIf.length>0){var t=0,i=this;if(this.ElseIf.IfAny(function(r){return(++t,r.Condition.Eval(i))?(n(r.Element,t),!0):!1}))return}this.Else?n(this.Else,-2):n(null,-1);return};t.IfElement.prototype.ProcessElement=function(n,i){var r=this,u=this.RenderedIndex;this.Watcher==null&&(this.Watcher=new t.IfWatcher(this.ViewModel,this),this.AddWatcher(this.ViewModel,this.Watcher));this.FindBlock(function(t,f){t&&u!=f?(n&&r.Clear(),r.Element=t,r.ProcessChildren(n,i),r.Element=r.If,r.RenderedIndex=f):t||(r.Clear(),r.RenderedIndex=-1)});return};t.IfElement.prototype.AddElseIf=function(n){var t=this.ViewModel.CreateCondition(ch.AttributeValue(n,"test",!0));t&&this.ElseIf.push({Element:n,Condition:t})};t.IfElement.prototype.AddElse=function(n){this.Else=n};t.Variable=function(n,i,r,u){if(t.CheetahElement.call(this,n,i,r,u),this.VariableName=ch.AttributeValue(r,"name",!0),ch.IsEmpty(this.VariableName))throw"Missing variable name";var f=this.Element.innerHTML;t.IsCheetahExpression(f)||f.indexOf("<")!=-1?(this.Builder=new t.VariableBuilder(this,this.VariableName),this.ProcessChildren()):this.ParentContext.SetVar(this.VariableName,f)};t.Variable.inherits(t.CheetahElement);t.Variable.prototype.ProcessElement=function(){this.ProcessChildren()};t.VariableBuilder=function(n,i){this.VarContext=n;this.Context=n.ParentContext;this.Name=i;this.CreateTextNode=function(n,i,r,u){return new t.VariableTextNode(n,i,r,u,this.VarContext)}};t.VariableBuilder.prototype.FindElement=function(){return null};t.VariableBuilder.prototype.GetContents=function(){return""};t.VariableBuilder.prototype.SetContents=function(n,t){this.Context.SetVar(this.Name,t)};t.VariableBuilder.prototype.RenderText=function(n,t,i,r){this.Context.SetVar(this.Name,r)};t.VariableBuilder.prototype.AppendChild=function(){i()};t.VariableBuilder.prototype.InsertBefore=function(){i()};t.VariableBuilder.prototype.MoveElement=function(){i()};t.VariableBuilder.prototype.AppendText=function(n,t){this.Context.SetVar(this.Name,t)};t.VariableBuilder.prototype.InsertTextBefore=function(){i()};t.VariableBuilder.prototype.RemoveChild=function(){i()};t.VariableBuilder.prototype.RemoveFromParent=function(){i()};t.BindElement=function(n,i,r,u){var f,o,e;if(t.CheetahElement.call(this,n,i,r,u),this.Bind=ch.AttributeValue(this.Element,"on",!0),this.IsCheetahElement=!0,ch.IsEmpty(this.Bind))throw"Missing 'on' attribute for ch-bind";f=ch.GetModelValue(this.Model,this.Bind,this);o=Array.isArray(f);this.Sort=ch.AttributeValue(this.Element,"sort");o&&this.Watch&&(e="",ch.IsEmpty(this.Sort)||(e=ch.Evaluate(this.EvaluateText(this.ViewModel,this.Sort))),this.AddWatcher(this.ViewModel,new t.BindWatcher(this,f,e)))};t.BindElement.inherits(t.CheetahElement);t.BindElement.prototype.ProcessElement=function(){var n=ch.GetModelValue(this.Model,this.Bind,this),t,i;n&&(this.Sort&&n.length!=undefined&&n.length!=0&&(t=ch.Evaluate(this.EvaluateText(this.ViewModel,this.Sort)),ch.IsEmpty(t)||ch.Sort(n,t)),n.$$parent=this.Model,n.$$path=this.Bind,i=this.CreateChild(this.Element,this.ViewModel),i.Model=n,i.Render(this.Element,n));return};t.BindElement.prototype.Render=function(n,i,u){if(!ch.IsValid(i))return!1;if(i.$$id=this.ViewModel.ModelID++,i.$$index=-1,typeof i!="string"&&i.length!=undefined){var f=0,e=null,o=this,s=this.ViewModel;return i.ForEach(function(h){if(ch.IsValid(h)){h.$$id=s.ModelID++;h.$$parent=i;h.$$index=f;h.$$path="["+f;var c=new t.DOMElement(s,o,n,h);c.Position=f;c.NewElement=o.NewElement;c.IsArrayElement=!0;u&&!e&&(e=r(c));c.ProcessChildren(u,e);c.PostProcess()}f++})}return this.ProcessChildren(u),!0};t.DOMElement=function(n,i,r,u){t.Element.call(this,n,i,r,u);this.Transform=null;this.Name=this.TransformInstance.$name=r.localName;this.Position=0;this.RenderElement=!0;this.PreserveSpace=!1;this.Sort=null;this.Events=[];this.Route="";this.Condition=null;this.ConditionName=null;this.Template=null;this.Contents="";this.Bind="";this.Async=!1;this.Attributes=null;this.Class="";this.Style="";this.CondResult=!0;this.Position=i?i.Position:0};t.DOMElement.inherits(t.Element);t.DOMElement.prototype.ProcessElement=function(n,t){var i=this;this.PreProcess(n,t)&&!this.Transform.DontRenderChildren&&(this.Async?this.ViewModel.Async.push(function(){i.parent.ProcessElement.call(i,n,t)}):this.parent.ProcessElement.call(this,n,t));this.RenderElement&&this.Builder.EndElement();this.TransformMethod("PostProcess",function(n){n.PostProcess(i.NewElement)});return};t.DOMElement.prototype.SetAttribute=function(n,t){var i=this;this.TransformMethod("SetAttribute",function(r){r.SetAttribute(i.NewElement,n,t)})||this.Builder.SetAttribute(this.NewElement,n,t)};t.DOMElement.prototype.OnChange=function(){this.OnRender&&this.OnRender(this);this.parent.OnChange.call(this)};t.DOMElement.prototype.CheckTransform=function(){var i=null,e,r,u;if(ch.IsValid(this.ParentContext.InTransform)&&ch.IsValid(this.ParentContext.InTransform.ChildTransforms)&&(i=this.ParentContext.InTransform.ChildTransforms[this.Name]),ch.IsValid(i)||(i=t.Transforms[this.Name],i&&i.RequiredParent&&(e=this.GetNonCheetahAncestor(),r=i.RequiredParent.split(","),r.IfAny(function(n){return n==e.Name})||n.Logger.Error(i.Name+" must be a child of "+i.RequiredParent+" (ignoring Cheetah elements)"))),ch.IsValid(i)?(this.InTransform=i,this.IgnoreText=i.IgnoreText,ch.IsEmpty(i.NewName)&&(this.RenderElement=!1),i.CreateInstance&&(this.TransformInstance=i.CreateInstance(),this.ResolveTransformInstance()),i.CreateBuilder&&(this.Builder=i.CreateBuilder(),this.TransformInstance&&i.CreateBuilder&&(this.TransformInstance.$builder=this.Builder))):(i=new f(this.Name),this.InTransform=this.ParentContext.InTransform),this.Name.indexOf("ch-")==-1&&this.ParentContext&&this.ParentContext.InTransform&&this.ParentContext.InTransform.AllowedChildren){var r=this.ParentContext.InTransform.AllowedChildren.split(","),e=this.ParentContext,o=this;r.IfAny(function(n){return n==o.Name})||n.Logger.Error(this.Name+" is not allowed as a child of "+this.ParentContext.InTransform.Name+" (ignoring Cheetah elements)")}ch.IsEmpty(i.UseTemplate)||(u=ch.AttributeValue(this.Element,"ch-bind"),ch.IsValid(u)&&this.Builder.SetAttribute(this.Element,"bind",u),this.Builder.SetAttribute(this.Element,"name",i.UseTemplate),this.Name="ch-call-template",this.IsCheetahElement=!0,i=new f(i.UseTemplate),this.InTransform=this.ParentContext.InTransform);this.Transform=i};t.DOMElement.prototype.PreProcess=function(n,t){this.CheckTransform();var i=this;if(this.Name.indexOf("ch-")==0&&this.ProcessCheetahElement())return!1;if(this.RenderElement){if(this.ProcessAttributes(this.ViewModel),this.RenderNewElement(n,t))return!1}else this.Transform.IsIdentity||(this.TransformAttributes(function(){i.ProcessAttributes(i.ViewModel)}),this.TransformOnRender(null,this.Model));return!0};t.DOMElement.prototype.TransformOnRender=function(n,t){var i=this;this.TransformMethod("OnRender",function(i){i.OnRender(n,t)})};t.DOMElement.prototype.TransformAttributes=function(n){var t=this;this.TransformMethod("TransformAttributes",function(i){n&&n();i.TransformAttributes(t.Attributes)})};t.DOMElement.prototype.TransformMethod=function(n,t){if(this.TransformInstance&&this.TransformInstance[n])t(this.TransformInstance);else if(this.Transform[n])t(this.Transform);else return!1;return!0};t.DOMElement.prototype.ProcessCheetahElement=function(){var f=this.ViewModel,r,e,u,i;this.IsCheetahElement=!0;switch(this.Name.substr(3)){case"include":case"template":return!0;case"call-template":if(r=ch.AttributeValue(this.Element,"name",!0),r==null)return!0;if(this.RenderElement=!1,e=t.Templates[r],!ch.IsValid(e))return n.Logger.Error("Undefined template called: "+r),!0;u=this;this.Element.attributes.ForEach(function(n){if(n.localName!="name"){var i=new t.VariableWatcher(f,u.ParentContext,n.localName,n.value);u.Watch&&u.AddWatcher(f,i,t.Priority.High);i.Eval(f,!0)}});this.Contents=this.Element.innerHTML;this.Element.innerHTML=e;break;case"template-contents":for(this.RenderElement=!1,i=this.ParentContext;ch.IsValid(i);){if(i.Name=="ch-call-template"){this.Element.innerHTML=i.Contents;break}i=i.ParentContext}if(!ch.IsValid(i))return n.Logger.Error("'ch-template-contents' element not found within a 'ch-template' element"),!0;break;default:return n.Logger.Warning("Unknown Cheetah element: '"+this.Name+"'"),!0}return!1};t.DOMElement.prototype.ProcessAttributes=function(i){var o=this.Element.attributes,s=[],h,f,r,u,c,e;if(o!=null)for(h=o.length,f=0;f<h;++f)if(r=o[f],u=r.localName,u.indexOf("data-ch-")==0&&(u=u.substr(5)),u.indexOf("ch-")==0)switch(u.substr(3)){case"bind":this.Bind=r.value;break;case"async":this.Async=r.value.toLowerCase()=="true";break;case"preserve-space":this.PreserveSpace=r.value.toLowerCase()=="true";break;case"watch":break;case"visible":this.Watch&&this.AddWatcher(i,new t.VisibilityWatcher(i,this,r.value),t.Priority.Default,!0);break;case"click":case"mouseover":case"mouseenter":case"mouseleave":this.Events.push({Name:u.substr(3),Value:r.value});break;case"checked":case"disabled":case"readonly":case"selected":this.Watch&&this.AddWatcher(i,new t.AttributeWatcher(i,this,u.substr(3),r.value,1),t.Priority.Default,!0);break;case"style":this.Style=r.value;break;case"class":this.Class=r.value;break;case"route":this.Route=ch.Evaluate(this.EvaluateText(i,r.value));break;default:n.Logger.Warning("Unknown Cheetah attribute: '"+u+"'")}else this.Watch&&t.IsCheetahExpression(r.value)&&(c=new t.AttributeNodeWatcher(i,this,u,r.value),this.AddWatcher(i,c,t.Priority.Default,!1)),e=String(ch.Evaluate(this.EvaluateText(i,r.value))),r.localName=="href"&&(e=e.replaceAll(" ","")),s.push(new n.Attribute(r.localName,e.replaceAll('"',"'")));this.Attributes=s;return};t.DOMElement.prototype.RenderNewElement=function(i,r){var f=this,u=this.ViewModel,e=!1,o=r||this.GetRenderParent(),s,h;return(this.NewElement=i?this.Builder.InsertBefore(o,this.Transform.NewName):this.Builder.AppendChild(o,this.Transform.NewName),this.NewElement&&(this.NewElement.$context=this),this.TransformAttributes(),this.IsCheetahElement||(s=this.NewElement,this.Attributes.ForEach(function(n){f.Builder.SetAttribute(s,n.Name,n.Value)})),this.TransformOnRender(this.NewElement,this.Model),this.IsCheetahElement)?e:this.Condition!=null&&!this.CondResult?e:(this.Transform.IsEditable&&this.Bind!=""&&(this.Watch&&this.TransformMethod("OnBind",function(){try{f.AddWatcher(u,new t.PropertyWatcher(u,f),t.Priority.Default,!0)}catch(i){n.Logger.Error(i.description)}}),this.ProcessChildren(),e=!0),this.Watch&&!ch.IsEmpty(this.Class)&&this.AddWatcher(u,new t.ClassWatcher(u,this,this.Class),t.Priority.Default,!0),this.Watch&&!ch.IsEmpty(this.Style)&&this.AddWatcher(u,new t.StyleWatcher(u,this,this.Style),t.Priority.Default,!0),this.Events.ForEach(function(n){f.RenderEvent(u,n.Name,n.Value)}),this.Route!=""&&(h=this.Route,$(this.NewElement).click(function(){u.RunRoute(h,null,!0)})),e)};t.DOMElement.prototype.RenderEvent=function(t,i,r){var u,f,e,o,s;if(!ch.IsEmpty(r)){if(u=this,r.indexOf(":")!=-1)if(f=r.split(":"),f.length!=2)n.Logger.Error("Syntax error on 'ch-'"+i+" attribute");else{e=$.trim(f[0]);o=t.CreateExpression($.trim(f[1]));$(this.NewElement).on(i,function(){var n=o.Eval(u);ch.SetModelValue(u.Model,e,n);t.UpdateView()})}else{s=t.HandleClick(this,r,!0);$(u.NewElement).on(i,s)}return}}}(i,t);n.Attribute=function(n,t){this.Name=n;this.Value=t};i.Action=function(t,i,r,u){this.Steps=[];this.ViewModel=t;this.Name=r?ch.AttributeValue(r,"name"):"";this.NumAnimations=0;this.Trigger=r?ch.AttributeValue(r,"trigger"):"";this.Parent=u;this.OnFail=null;this.Run=function(t){try{var i=!1;this.NumAnimations=0;this.Steps.ForEach(function(n){i=n(t)||i},!1);i&&this.ViewModel.UpdateView()}catch(r){n.Logger.Error(r.description)}};var f=this;r.childNodes.ForEach(function(n){f.HandleStep(i,n)})};i.Action.prototype.EvalExpression=function(n,t,r){var o,u,f,e;return r.indexOf("$$")==-1&&!i.IsCheetahExpression(r)?r:(o=this.ViewModel,u=ch.Coalesce(n.$model,t.Model),r=="$$target"||r=="//$$target//")?u:(f={},r.indexOf("$$result")!=-1&&(f.$$result=n.$$result),e=t.EvaluateText(this.ViewModel,r.replaceAll("$$target.","")),ch.Convert(ch.Evaluate(e,u,f)))};i.Action.prototype.EvalSetter=function(n,t,f,e){var s=ch.AttributeValue(f,"data"),o;if(ch.IsEmpty(s)){if(o="",o=ch.IsValid(f.attributes.value)?ch.AttributeValue(f,"value"):f.innerHTML,ch.IsEmpty(o)){i.LogError(5);return}var c=this.ViewModel,h=u(c,f),l=this;this.Steps.push(function(n){if(!r(h,n,t))return!1;var i=l.EvalExpression(n,t,o);return e(n,i)})}else this.Steps.push(function(n){if(!r(h,n,t))return!1;var i=$(ch.EventTarget(n)).data(s);return e(n,i)})};i.Action.prototype.EvalNamedSetter=function(n,t,r,u){var f=ch.AttributeValue(r,"name");if(ch.IsEmpty(f)){i.LogError(6);return}this.EvalSetter(n,t,r,function(n,t){return u(n,f,t)})};i.Action.prototype.EvalSelectSetter=function(n,t,r,u,f){var e=ch.AttributeValue(r,"select");if(ch.IsEmpty(e)){i.LogError(7);return}u?this.EvalNamedSetter(n,t,r,function(n,t,i){var r=ch.SelectTarget(n,e);f(r,t,i)}):this.EvalSetter(n,t,r,function(n,t){var i=ch.SelectTarget(n,e);f(i,t)})};i.Action.prototype.EvalClassSetter=function(n,t){var u=ch.AttributeValue(t,"select"),i=ch.AttributeValue(t,"add"),r=ch.AttributeValue(t,"remove");this.SetActionStep(n,t,function(n){var t=ch.SelectTarget(n,u);return ch.IsEmpty(r)||t.removeClass(r),ch.IsEmpty(i)||t.addClass(i),!1})};i.ShowElement=function(n,t){var i=null;i=n instanceof jQuery?n:typeof n=="string"?$("#"+n):$(n);i&&i.each(function(){this.$context&&this.$context.VisibilityWatcher?this.$context.VisibilityWatcher.Eval(this.$context.ViewModel,t):t?$(this).show():$(this).hide()})};i.Action.prototype.EvalVisibilitySetter=function(n,t){var r=ch.AttributeValue(t,"show"),u=ch.AttributeValue(t,"hide"),f="",e=!0;ch.IsEmpty(r)&&ch.IsEmpty(u)&&(f=ch.AttributeValue(t,"select"),e=ch.Convert(ch.AttributeValue(t,"value")));this.SetActionStep(n,t,function(n){return ch.IsEmpty(u)&&ch.IsEmpty(r)?i.ShowElement(ch.SelectTarget(n,f),e):(ch.IsEmpty(u)||i.ShowElement(ch.SelectTarget(n,u),!1),ch.IsEmpty(r)||i.ShowElement(ch.SelectTarget(n,r),!0)),!1})};i.Action.prototype.EvalChildConditionalSetter=function(t,i,r,u){var f=this.CreateChild(t,i),e;f==null?n.Logger.Error("No child steps for "+r+" step in action"):(e=this.ViewModel,this.SetActionStep(t,i,function(n){e[r](u,function(){f.Run(n)})}))};i.Action.prototype.SetActionStep=function(n,t,i){var f=u(this.ViewModel,t);this.Steps.push(function(t){return r(f,t,n)?i(t):!1})};i.Action.prototype.HandleStep=function(t,r){var s,f,e,c,u,l,a,h,v,o,y;if(r.localName){s=r.localName.toLowerCase();f=this.ViewModel;switch(s){case null:break;case"propertysetter":this.EvalSelectSetter(self,t,r,!0,function(n,t,i){return n.attr(t,i),!1});break;case"stylesetter":this.EvalSelectSetter(self,t,r,!0,function(n,t,i){return n.css(t,i),!1});break;case"classsetter":this.EvalClassSetter(t,r);break;case"visibilitysetter":this.EvalVisibilitySetter(t,r);break;case"modelsetter":this.EvalNamedSetter(self,t,r,function(n,i,r){var u=null,e;return i.indexOf("$$root.")==0?(u=f.ActualViewModel.Model,i=i.substr(7)):u=ch.Coalesce(n.$model,t.Model),typeof r=="object"&&r.$$id&&(e=ch.GetModelValue(u,i),r=ch.Clone(r),r.$$id=f.ModelID++,r.$$index=-1,e&&(r.$$path=e.$$path,r.$$parent=e.$$parent)),ch.SetModelValue(u,i,r),!0});break;case"remove":this.EvalSelectSetter(self,t,r,!1,function(n){n.remove()});break;case"reloadmodel":this.SetActionStep(t,r,function(){return f.SuppressUpdate=!0,f.ActualViewModel.LoadModel(),!1});break;case"call":e=$.trim(r.innerHTML);e=ch.Evaluate(t.EvaluateText(this.ViewModel,e));c=this.ViewModel.HandleClick(t,e,!1);this.SetActionStep(t,r,function(n){c(n)});break;case"writeconsole":u=$.trim(r.innerHTML);u=t.EvaluateText(this.ViewModel,u);this.SetActionStep(t,r,function(){n.Logger.Error(ch.Evaluate(u))});break;case"message":u=$.trim(r.innerHTML);l=ch.AttributeValue(r,"type");u=t.EvaluateText(this.ViewModel,u);this.SetActionStep(t,r,function(){switch(l){case"error":f.OnError(u);break;default:f.OnInfo(u)}});break;case"confirm":a=ch.AttributeValue(r,"message");this.EvalChildConditionalSetter(t,r,"Confirm",a);break;case"validate":h=new i.Validator(this.ViewModel,t,r,this);h.IsValid&&this.Steps.push(function(n){h.Validate(n)});break;case"redirect":v=$.trim(r.innerHTML);this.SetActionStep(t,r,function(){ch.Redirect(v)});break;case"onfail":this.Parent&&(this.OnFail=this.CreateChild(t,r));break;case"delay":o=ch.AttributeValue(r,"for");y=this.CreateChild(t,r);o=t.EvaluateText(this.ViewModel,o);this.SetActionStep(t,r,function(n){var t=Number(ch.Evaluate(o));ch.IsValidNumber(t)||(t=100);setTimeout(function(){y.Run(n)},t)});break;default:this.HandleCustomStep(t,r,s)}}};i.Action.prototype.CreateChild=function(n,t){if(!ch.IsEmpty(t.childNodes)){var r=new i.Action(this.ViewModel,n,t,this);if(r.Steps.length!=0)return r}return null};i.Action.prototype.HandleCustomStep=function(t,r,u){var f=i.ActionSteps[u],o=this;if(f){var s={},e=null,h=this.ViewModel;f.ProcessAttributes&&(s=f.ProcessAttributes(r.attributes)||{});f.AllowChildren&&(e=this.CreateChild(t,r));this.SetActionStep(t,r,function(r){var l,u,a,c,y,v;try{f.IsAnimation&&++o.NumAnimations;l=h.ActualViewModel;u=ch.Clone(s);for(a in u)c=u[a],(i.IsCheetahExpression(c)||c=="$$target")&&(u[a]=o.EvalExpression(r,t,c));return e==null?f.Run(r,t.NewElement,l,u):(y=ch.IsValid(t.ParentContext)?t.ParentContext.NewElement:null,r.$$result={},v=null,e.OnFail&&(v=function(){e.OnFail.Run(r)}),f.Run(r,y,l,u,function(){e.Run(r)},v))}catch(p){return n.Logger.Error(p.description),!1}})}else n.Logger.Warning("Unknown Action step: "+r.localName)};i.ValidatorItem=function(t,i,f){function c(n,t,i,r,u,f){var o="",s=f,e;this.ErrorMessage="";e=u.indexOf(";");o=u;e!=-1&&(this.ErrorMessage=t.EvaluateText(n,u.substr(e+1)),o=t.EvaluateText(n,u.substr(0,e)));this.Validate=function(n,t){var r={$$root:n.Model},i=ch.Convert(ch.Evaluate(o,t,r));return ch.IsEmpty(i)?!0:s(i,t)}}var e=ch.AttributeValue(f,"name"),o=[],s=u(t,f),h=i;this.IsValid=!ch.IsEmpty(e);this.ErrorMessage="";this.AddValidator=function(n,t,i,r){var u=ch.AttributeValue(t,i);ch.IsEmpty(u)||o.push(new c(n,h,t,i,u,r))};this.Validate=function(n,t,i,u,f){if(!r(s,t,i))return!0;var h=ch.Coalesce(t.$model,i.Model),c=!0;return h=ch.GetBindData(e,h),o.ForEach(function(t){if(!t.Validate(n,h)){c=!1;var i={$$root:n.Model};if(u.push({Name:e,Message:ch.Evaluate(t.ErrorMessage,h,i)}),f)return!1}return!0},!0),c};this.IsValid?(this.AddValidator(t,f,"required",function(n,t){return!n||!ch.IsEmpty(t)}),this.AddValidator(t,f,"minlength",function(n,t){return n==0||!ch.IsEmpty(t)&&t.length>=n}),this.AddValidator(t,f,"minvalue",function(n,t){return Number(t)>=n}),this.AddValidator(t,f,"maxvalue",function(n,t){return Number(t)<=n})):n.Logger.Error("Validate action step is missing a name for Model item.")};i.Validator=function(t,f,e,o){var v=t,s=f,p=ch.Convert(ch.AttributeValue(e,"report-silent")),h=ch.Convert(ch.AttributeValue(e,"report-all")),c=ch.AttributeValue(e,"report-to"),w=u(t,e),l=null,a=null,y=[];this.IsValid=!0;e.childNodes.ForEach(function(r){if(ch.IsValid(r.localName))switch(r.localName.toLowerCase()){case"model":var u=new i.ValidatorItem(t,s,r);u.IsValid&&y.push(u);break;case"onvalidate":l=o.CreateChild(f,r);break;case"onfail":a=o.CreateChild(f,r);break;default:n.Logger.Error("Unknown child step for Validate action step.")}});this.Validate=function(n){var t,u,i;if(r(w,n,s)){if(t=[],u=!0,y.ForEach(function(i){return!i.Validate(v,n,s,t,!h)&&(u=!1,!h)?!1:!0},!0),!u){p||(i="Validation failed!",t.length>0&&(i=h?ch.IsEmpty(c)?t.Pack("\r\n",function(n){return n.Message}):"<ul>"+t.Pack("\r\n",function(n){return"<li>"+n.Message+"<\/li>"})+"<\/ul>":"<ul><li>"+t[0].Message+"<\/li><\/ul>"),ch.IsEmpty(c)?v.OnError(i):$(c).html(i));a&&(n.$$result=t,a.Run(n));return}l!=null&&l.Run(n)}}};i.Watcher=function(n){this.IsWatcher=!0;this.ViewModel=n;this.Eval=function(){}};i.ElementWatcher=function(n,t){i.Watcher.call(this,n);this.Context=t;this.ReRender=function(n,t,i){i=ch.Coalesce(i,this.Context);i.Clear();(t==undefined||t)&&(i.Render(i.Element,n,!0),this.ViewModel.ProcessDeferred())}};i.Property=function(t,i){var r=t.indexOf(".")!=-1?t.split("."):t,u=i;this.SetValue=function(n){var f,t;if(typeof r=="string")u[r]=n;else{for(f=r.length,t=0;t<f-1;++t)u=i[r[t]];u[r[f-1]]=n}};this.GetValue=function(){var f,t,i;try{if(typeof r=="string")return u[r];for(f=r.length,t=u,i=0;i<f;++i)if(t=t[r[i]],!t)return null;return t}catch(e){n.Logger.Error(e.description)}}};i.PropertyWatcher=function(n,t){function s(n){n.TransformMethod("SetValue",function(t){t.SetValue(n.NewElement,r.GetValue())})}var u,r,f,e,o;i.ElementWatcher.call(this,n,t);u=!1;r=t.Bind;this.OnChange=function(n){u||(u=!0,r.SetValue(n),this.ViewModel.UpdateView(),u=!1)};this.Eval=function(){u||s(this.Context)};f=r.split(":");f.length==2&&(r=$.trim(f[0]));e=this;o=r;r=new i.Property(r,t.Model);t.TransformMethod("OnBind",function(n){n.OnBind(t.NewElement,o,function(n){e.OnChange(n)})})};i.ModelWatcher=function(t,r){function e(n,t){this.Attribute=new i.Property(t,n.Model);this.Value=this.Attribute.GetValue();this.Changed=function(){var n=this.Attribute.GetValue(),t=this.Value!=n;return this.Value=n,t}}function o(n,t){this.Name=t;this.Value=n.GetVar(t);this.Changed=function(n){var t=n.GetVar(this.Name),i=this.Value!=t;return this.Value=t,i}}i.ElementWatcher.call(this,t,r);var u=new n.KeyedSet,f=new n.KeyedSet;this.ModelChanged=function(n,t){var r=this.Context,i;return(n=ch.Coalesce(n,r.Model),!n)?!0:(i=n,ch.IsEmpty(n.$$path)||(i=ch.GetModelValue(n.$$parent,n.$$path,this.Context)),!i||i.$$id==undefined||i.$$id!=n.$$id)?(i.$$parent=n.$$parent,this.ReRender(i),!1):(t!=undefined&&(t.Model=i),u.IfAny(function(t){return t.Changed(n)}))?!0:f.IfAny(function(n){return n.Changed(r)})};this.AddProperty=function(n,t){u.Contains(t)||u.Add(t,new e(n,t))};this.AddVariable=function(n,t){f.Contains(t)||f.Add(t,new o(n,t))};this.AddProperties=function(n,t){if(ch.IsValid(t)){typeof t=="string"&&this.AddProperty(n,t);var i=this;ch.IsValid(t.length)&&t.ForEach(function(t){i.AddProperty(n,t)})}};this.AddVars=function(n,t){if(ch.IsValid(t)){typeof t=="string"&&this.AddVariable(n,t);var i=this;ch.IsValid(t.length)&&t.ForEach(function(t){i.AddVariable(n,t)})}}};i.BindWatcher=function(n,t,r){i.ModelWatcher.call(this,n.ViewModel,n);var s=n.ViewModel,u=t,o=t.length,e=r,f=!1;this.BaseReRender=this.ReRender;this.BaseModelChanged=this.ModelChanged;this.ModelChanged=function(){var i,n,r;return(f=!1,i={},this.BaseModelChanged(u,i))?!0:f?!1:(u=i.Model,n=0,r=!1,ch.IsValid(e)&&ch.Sort(u,e),u.ForEach(function(i){ch.IsValid(i.$$index)&&i.$$index==n||(r=!0,i.$$index=n);i.$$parent=t;++n}),r)};this.ReRender=function(n,t){f=!0;u=n;o=u.length;this.BaseReRender(n,t)};this.Eval=function(){this.ModelChanged()&&this.ReRender(u)}};i.IfWatcher=function(n,t){i.ElementWatcher.call(this,n,t);var r=[],u=[],f=ch.ShallowClone(t.Model);r.push(t);u.push(t.Condition.Eval(t));this.AddElse=function(n){r.push(n);u.push(n.Condition.Eval(n))};this.Eval=function(){this.Context.ProcessElement(!0,null)}};i.TextExpression=function(n,t,i){this.ViewModel=n;this.Context=t;this.OriginalText=i;this.Parts=[];this.Expressions=[];this.Init(i)};i.TextExpression.prototype.Evaluate=function(n,t){if(this.Expressions.length==0)return this.Parts.Pack("");if(this.Expressions.length==1&&this.Parts.length==1)return this.Parts[0].Eval(this.Context,n,t);var i=this;return this.Parts.Reduce(function(r,u){return typeof u=="string"?r+u:r+ch.NormalizeText(u.Eval(i.Context,n,t))},"")};i.TextExpression.prototype.Init=function(t){for(var i=t.indexOf(n.StartDelimiter),f=t,u,r;i!=-1;){if(i>0&&this.Parts.push(t.substr(0,i)),t=t.substr(i+n.StartDelimiter.length),i=t.indexOf(n.EndDelimiter),i==-1)break;u=$.trim(t.substr(0,i));t=t.substr(i+n.EndDelimiter.length);r=this.ViewModel.CreateExpression(u);this.Parts.push(r);this.Expressions.push(r);i=t.indexOf(n.StartDelimiter)}t!=""&&this.Parts.push(t);return};i.TextExpressionWatcher=function(n,t,r){var u,f;i.ModelWatcher.call(this,n,t);u=typeof r=="string"?new i.TextExpression(n,t,r):r;this.Eval=function(n,t){(t||this.ModelChanged())&&this.Resolve(u.Evaluate())};this.Resolve=function(){};f=this;u.Expressions.ForEach(function(n){f.AddProperties(t,n.ModelTokens);f.AddVars(t,n.VarTokens)})};i.TextNodeWatcher=function(n,t,r){i.TextExpressionWatcher.call(this,n,t,r);this.Resolve=function(n){this.Context.RenderText(null,null,n);this.Context.OnChange()}};i.AttributeNodeWatcher=function(n,t,r,u){i.TextExpressionWatcher.call(this,n,t,u);var f=r;this.Resolve=function(n){this.Context.SetAttribute(f,n)}};i.VariableWatcher=function(n,t,r,u){i.TextExpressionWatcher.call(this,n,t,u);var f=r;this.Resolve=function(n){this.Context.SetVar(f,n)}};i.ClassWatcher=function(n,t,r){function e(t){var i=t.indexOf(":");i==-1?(this.Name=t,this.Condition=null):(this.Name=$.trim(t.substr(0,i)),this.Condition=n.CreateCondition(t.substr(i+1)));this.Set=function(n,t){if(this.Condition==null||this.Condition.Eval(n)){var i=this.Name;return ch.IsEmpty(t)||(i=ch.Evaluate(t)+" "+i),n.NewElement.className=i,!0}return!1}}i.ModelWatcher.call(this,n,t);this.Static=t.EvaluateText(n,ch.AttributeValue(t.NewElement,"class"));this.Parts=[];this.Eval=function(n,t){if(t||this.ModelChanged()){var i=this;this.Parts.ForEach(function(n){return!n.Set(i.Context,i.Static)},!0)}};var f=r.split(","),u=this;f.ForEach(function(n){var i=new e(n);u.Parts.push(i);i.Condition!=null&&u.AddProperties(t,i.Condition.ModelTokens)})};i.StyleWatcher=function(t,r,u){function o(n){var i=n.indexOf(":");this.Name=$.trim(n.substr(0,i));this.Expression=t.CreateExpression(n.substr(i+1));this.Eval=function(n){return this.Expression.Eval(n)}}i.ModelWatcher.call(this,t,r);this.Static=r.EvaluateText(t,ch.AttributeValue(r.NewElement,"style"));this.Parts=[];this.Eval=function(t,i){var r,u;(i||this.ModelChanged())&&(r=this,ch.IsEmpty(this.Static)||(u=this.Static.split(";"),u.ForEach(function(t){var i=t.split(":");n.Builder.css(r.Context.NewElement,i[0],i[1])})),this.Parts.ForEach(function(t){var i=t.Eval(r.Context);n.Builder.css(r.Context.NewElement,t.Name,i)}))};var e=u.split(";"),f=this;e.ForEach(function(n){var t=new o(n);f.Parts.push(t);f.AddProperties(r,t.Expression.ModelTokens)})};i.AttributeWatcher=function(n,t,r,u,f){i.ModelWatcher.call(this,n,t);var s=f==1,e=r,o=f==1?n.CreateCondition(u):n.CreateExpression(u);this.Eval=function(n,t){if(t||this.ModelChanged()){var i=o.Eval(this.Context);s?i?this.Context.SetAttribute(e,e):this.Context.Builder.RemoveAttribute(this.Context.NewElement,e):this.Context.SetAttribute(e,i)}};ch.IsEmpty(o.ModelTokens)||this.AddProperties(t,o.ModelTokens)};i.VisibilityWatcher=function(n,t,r){i.ElementWatcher.call(this,n,t);this.Condition=n.CreateCondition(r);this.HideAction=null;this.ShowAction=null;t.VisibilityWatcher=this;this.Eval=function(n,t){var r=t!=undefined?t:this.Condition.Eval(this.Context),i=r?this.ShowAction:this.HideAction;i!=null&&(i.Run(),i.NumAnimations>0)||(r?$(this.Context.NewElement).show():$(this.Context.NewElement).hide())}};n.Service=function(){var n=t.location.toString(),r=n.indexOf("/",n.indexOf("://")+3),i=n.substring(0,r)+"/",u=n.indexOf("/",n.indexOf(i)+i.length);this.RootFolder=n.substring(0,u)};n.Service.prototype.GetResult=function(n){return ch.IsValid(n)?ch.IsValid(n.Result)?n.Result:n:null};n.Service.prototype.IsResultError=function(n){return ch.IsValid(n.Errors)||ch.IsValid(n.Error)};n.Service.prototype.GetErrorResult=function(n){return n};n.Service.prototype.OnError=function(n,t){ch.IsValid(t)?t(n):alert(n)};n.Service.prototype.NormalizeUrl=function(n,t){return(n=n.replaceAll("\\","/"),n.indexOf("~")==-1)?n.indexOf("/")==-1&&!ch.IsEmpty(t)?t+"/"+n:n:n.replace("~/",this.RootFolder.EnsureEndsWith("/"))};n.Service.prototype.LoadModel=function(n,t,i,r,u){this.QueryFolder(n,t,"models",i,r,u,"LoadModel")};n.Service.prototype.LoadView=function(n,t,i,r,u){this.QueryFolder(n,t,"views",i,r,u,"LoadView")};n.Service.prototype.DoAction=function(n,t,i,r){this.QueryFolder(n,"POST","actions",t,i,r,"DoAction")};n.Service.prototype.QueryFolder=function(t,i,r,u,f,e,o){i=="POST"||i=="GET"?this.Query(this.NormalizeUrl(t,r),i,u,f,e):n.Logger.Error("Only 'POST' or 'GET' for Cheetah.Service."+o)};n.Service.prototype.Post=function(n,t,i,r){this.Query(n,"POST",t,i,r)};n.Service.prototype.Put=function(n,t,i,r){this.Query(n,"PUT",t,i,r)};n.Service.prototype.Get=function(n,t,i){this.Query(n,"GET",null,t,i)};n.Service.prototype.Delete=function(n,t,i){this.Query(n,"DELETE",null,t,i)};n.Service.prototype.Query=function(n,t,i,r,u){var f=this;jQuery.ajax({url:n,method:t,data:i}).done(function(n){n=f.GetResult(n);ch.IsValid(n)&&(f.IsResultError(n)?f.OnError(f.GetErrorResult(n),u):ch.IsValid(r)&&r(n))}).fail(function(n,t,i){f.OnError(i,u)})};i.Route=function(n,t,i){var w=t.Name,f=ch.Coalesce(t.Target,i.Target),a=ch.Coalesce(t.Model,i.Model),v=ch.Coalesce(t.ModelVerb,i.ModelVerb,"POST"),s=ch.Coalesce(t.ViewModel,i.ViewModel),e=ch.Coalesce(t.View,i.View),y=ch.Coalesce(t.ViewVerb,i.ViewVerb,"POST"),h=ch.Coalesce(t.RouteTable,i.RouteTable),r=null,u=null,p=n,c=null,o,l;this.Run=function(n,t){var i=this,o="?v="+Math.floor(Math.random()*100),f;if(u==null&&!ch.IsEmpty(e)){p.CreateService().LoadView(e+o,y,null,function(r){u=r;i.Run(n,t)});return}if(r==null&&(r=c(),r.ModelPath=a+o,r.ModelVerb=v,r.Template=u),!ch.IsEmpty(h)&&!r.HaveRoutes()){r.LoadRouteTable(h,function(){i.Run(n,t)});return}f=n;i=this;t&&(f=function(){ch.IsValid(r.FirstSubRoute)?r.FirstSubRoute.Run(n):ch.Do(n)});r.LoadModel(null,f)};o="Cheetah.ViewModel";ch.IsEmpty(s)||(o=s);l="return new "+o+"('"+f+"')";c=new Function(l);!ch.IsValid(e)&&ch.IsValid(f)&&(u=$("#"+f).html())};i.LoadFileTask=function(t,i){n.Task.call(this);var r=t,u=i;this.Html="";this.Start=function(){var t=this;r.Get(u,function(n){t.Html=n;t.Complete=!0;t.OnComplete()},function(i){n.Logger.Error(i);t.Complete=!0;t.OnComplete()})}};i.RequireAttribute=function(t,i,r,u){var f=ch.AttributeValue(t,i);return ch.IsEmpty(f)?(r&&n.Logger.Error(r),!1):(u&&u(f),!0)};i.RequireContent=function(t,i,r){var u=n.Builder.InnerText(t);return ch.IsEmpty(u)?(i&&n.Logger.Error(i),!1):(r&&r(u),!0)};i.IsCheetahExpression=function(t){var i,r;return!t||typeof t!="string"?!1:(i=t.indexOf(n.StartDelimiter),i==-1)?!1:(r=t.indexOf(n.EndDelimiter,i+n.StartDelimiter.length),r!=-1)};i.RemoveExpressionDelimiters=function(t){return t=$.trim(t).substr(n.StartDelimiter.length),t.substr(0,t.indexOf(n.EndDelimiter))};f=new function(){function e(t){var r=null,u;return n.Builder.ProcessElementsByName("ch-include",function(n){i.RequireContent(n,"Missing include path",function(n){t.push(n)})},!0)>0&&(u=n.Builder.FirstElementByName("body"),r=n.Builder.AppendChild(u,"div",function(n){n.style.display="none"})),r}var t=[],r=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(){n.Builder.ProcessElementsByName("ch-template",function(t){i.RequireAttribute(t,"name","Missing template name",function(r){i.Templates[r]=n.Builder.InnerHTML(t)})},!0);this.IsMet=!0}},u=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(t){t&&(t.childNodes.ForEach(function(n){n&&n.localName&&n.localName=="ch-action"&&i.RequireAttribute(n,"name","Missing action name",function(t){i.Actions[t]=n})}),n.Builder.RemoveFromParent(t));this.IsMet=!0}},f=new function(){this.IsMet=!1;n.RegisterPrerequisite(this);this.Start=function(f){var s=new n.Service,h=this,e=new n.TaskList(99999),o=[];t.ForEach(function(n){var t=new i.LoadFileTask(s,n);o.push(t);e.Add(t)});e.Run(function(){var t=new n.StringBuilder;o.ForEach(function(n){t.Append(n.Html)});f.innerHTML=t.ToString("\r\n");h.IsMet=!0;r.Start(f);u.Start(f)})}};this.Init=function(){var i=this,n=e(t);t.length!=0?f.Start(n):(f.IsMet=!0,r.Start(n),u.Start(n))}};$(t).ready(function(){var t,r,i,u;n.Builder=new n.DOMBuilder;n.Logger=new n.ConsoleLogger;f.Init();try{t=n.Builder.FirstElementByName("body");r=n.Builder.GetAttribute(t,"ch-mode",!0);r=="auto"&&(i=n.Builder.GetAttribute(t,"ch-route-table",!0),ch.IsEmpty(i)||(u=new n.ViewModel("body"),u.LoadRouteTable(i,null,!0)))}catch(e){n.Logger.Error(e.description)}})}(Cheetah,document);!function(n,t){n.StringBuilder=function(n){this._parts=[];ch.IsValid(n)&&this.Append(n)};n.StringBuilder.prototype.Clear=function(){this._parts=[]};n.StringBuilder.prototype.Append=function(n){this._parts.push(n)};n.StringBuilder.prototype.AppendLine=function(n){this.Append(n+"\r\n")};n.StringBuilder.prototype.ToString=function(n){return ch.IsValid(n)||(n=""),this._parts.join(n)};n.StringBuilder.prototype.ForEach=function(n,t){return this._parts.ForEach(n,t)};n.StringBuilder.prototype.Replace=function(n,t){this._parts[n]=t};n.KeyedSet=function(){var n=[],t={};this.Add=function(i,r){this.Contains(i)||(n.push(r),t[i]=r)};this.Contains=function(n){return t[n]!=undefined};this.IfAny=function(t){return n.IfAny(t)}};n.Session=new function(){this.SetValue=function(t,i){typeof Storage!="undefined"?sessionStorage.setItem(t,i):n.Cookie.SetValue(t,i)};this.GetValue=function(t){return typeof Storage!="undefined"?sessionStorage.getItem(t):n.Cookie.GetValue(t)};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(t){typeof Storage!="undefined"?sessionStorage.removeItem(t):n.Cookie.ClearValue(t)}};n.Storage=new function(){this.SetValue=function(t,i){typeof Storage!="undefined"?localStorage.setItem(t,i):n.Cookie.SetValue(t,i,5256e3)};this.GetValue=function(t){return typeof Storage!="undefined"?localStorage.getItem(t):n.Cookie.GetValue(t)};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(t){typeof Storage!="undefined"?localStorage.removeItem(t):n.Cookie.ClearValue(t)}};n.Cookie=new function(){this.SetValue=function(n,i,r){if(r)if(ch.IsEmpty(i)||i.indexOf("=")==-1||ch.IsValid(r))if(ch.IsValid(r)){var u=new Date(Date.now()+(r?r*6e4:0));t.cookie=n+"="+escape(i)+";expires="+u.toUTCString()}else t.cookie=n+"="+escape(i);else t.cookie=i;else t.cookie=n+"="+escape(i)};this.GetValue=function(n){var i,r;return t.cookie.length>0&&(i=t.cookie.indexOf(n+"="),i!=-1)?(i+=n.length+1,r=t.cookie.indexOf(";",i),r==-1&&(r=t.cookie.length),unescape(t.cookie.substring(i,r))):""};this.GetClearValue=function(n){var t=this.GetValue(n);return this.ClearValue(n),t};this.GetInt=function(n){var t=this.GetValue(n);return ch.IsEmpty(t)?0:parseInt(t)};this.ClearValue=function(n){this.SetValue(n,"",-1e3)}};n.Task=function(n){var t=n;this.OnComplete=null;this.Complete=!1;this.Start=function(){var n=this;try{t(function(){ch.IsValid(n.OnComplete)&&n.OnComplete();n.Complete=!0})}catch(i){alert(i.description)}}};n.TaskList=function(n){var t=[],i=0,f=n==undefined?8:n,r=null,u;this.Add=function(n){var i=this;n.OnComplete=function(){i.TaskComplete()};t.push(n)};this.Run=function(n){r=n;u()};u=function(){while(t.length>0&&i<f){var n=t.shift();++i;n.Start()}i==0&&t.length==0&&ch.IsValid(r)&&r()};this.WaitAll=function(){while(i>0||t.length>0)$("#j8_kl59aa_").html($("#j8_kl59aa_").html())};this.TaskComplete=function(){--i<f&&u()}};n.ConsoleLogger=function(){};n.ConsoleLogger.prototype.Error=function(n){console.error("CheetahJS: "+n)};n.ConsoleLogger.prototype.Warning=function(n){console.warn("CheetahJS: "+n)};n.ConsoleLogger.prototype.Log=function(n){console.log("CheetahJS: "+n)};n.DOMBuilder=function(){};n.DOMBuilder.prototype.FindElement=function(n){return ch.IsEmpty(n)?null:t.getElementById(n)};n.DOMBuilder.prototype.GetContents=function(n){return n.innerHTML};n.DOMBuilder.prototype.SetContents=function(n,t){n.nodeName=="#text"?n.nodeValue=t:n.innerHTML=t};n.DOMBuilder.prototype.AppendChild=function(n,t,i){var r=n.ownerDocument.createElement(t);return i&&i(r),n.appendChild(r),r};n.DOMBuilder.prototype.InsertBefore=function(n,t){var i=n.ownerDocument.createElement(t);return n.parentNode.insertBefore(i,n),i};n.DOMBuilder.prototype.MoveElement=function(n,t){return n.parentElement.removeChild(n),t.appendChild(n),n};n.DOMBuilder.prototype.AppendText=function(n,t){var i=n.ownerDocument.createTextNode(t);return n.appendChild(i),i};n.DOMBuilder.prototype.RenderText=function(n,t,i,r){return n?(this.SetContents(n,r),n):t&&i?this.InsertTextBefore(i,r):i?this.AppendText(i,r):void 0};n.DOMBuilder.prototype.InsertTextBefore=function(n,t){var i=n.ownerDocument.createTextNode(t);return n.parentNode.insertBefore(i,n),i};n.DOMBuilder.prototype.RemoveChild=function(n,t){n.removeChild(t)};n.DOMBuilder.prototype.RemoveFromParent=function(n){n.parentElement&&n.parentElement.removeChild(n)};n.DOMBuilder.prototype.ShowElement=function(n,t){n.style.display=t?"block":"none"};n.DOMBuilder.prototype.GetAttribute=function(n,t,i){var r=n.getAttribute(t);return r&&i&&this.RemoveAttribute(n,t),r};n.DOMBuilder.prototype.SetAttribute=function(n,t,i){n.setAttribute(t,i)};n.DOMBuilder.prototype.RemoveAttribute=function(n,t){n.removeAttribute(t)};n.DOMBuilder.prototype.InnerHTML=function(n,t){return t!=undefined?n.innerHTML=t:n.innerHTML};n.DOMBuilder.prototype.InnerText=function(n,t){return t!=undefined?n.innerText=t:$.trim(n.innerText)};n.DOMBuilder.prototype.ElementsByName=function(n){return t.getElementsByTagName(n)};n.DOMBuilder.prototype.ProcessElementsByName=function(n,i,r){var o=t.getElementsByTagName(n),u=o.length,f,e;if(u>0){for(f=0;f<u;++f)i(o[f]);if(r)for(e=u-1;e>=0;--e)this.RemoveFromParent(o[e])}return u};n.DOMBuilder.prototype.ProcessElementsByQuery=function(n,t){var i=$(n);return i.each(function(){t(this)}),i.length};n.DOMBuilder.prototype.FirstElementByName=function(n){var i=t.getElementsByTagName(n);return i.length>0?i[0]:undefined};n.DOMBuilder.prototype.EndElement=function(){};n.DOMBuilder.prototype.css=function(n,t,i){$(n).css(t,i)};n.DOMStringBuilder=function(){this.sb=new n.StringBuilder;this.tags=[];this.currentTagEnded=!0};n.DOMStringBuilder.prototype.Clear=function(){this.sb.Clear();this.tags=[];this.currentTagEnded=!0};n.DOMStringBuilder.prototype.ToString=function(){return this.sb.ToString("")};n.DOMStringBuilder.prototype.FinishStartTag=function(){this.currentTagEnded||(this.sb.Append(">"),this.currentTagEnded=!0)};n.DOMStringBuilder.prototype.AppendChild=function(n,t,i){this.FinishStartTag();this.sb.Append("<"+t);this.tags.push(t);this.currentTagEnded=!1;i&&i(null)};n.DOMStringBuilder.prototype.EndElement=function(){var n=this.tags.pop();this.FinishStartTag();this.sb.Append("<\/"+n+">")};n.DOMStringBuilder.prototype.InsertBefore=function(n,t){this.AppendChild(n,t)};n.DOMStringBuilder.prototype.AppendText=function(n,t){this.FinishStartTag();this.sb.Append(t)};n.DOMStringBuilder.prototype.RenderText=function(n,t,i,r){this.AppendText(null,r)};n.DOMStringBuilder.prototype.InsertTextBefore=function(n,t){this.AppendText(null,t)};n.DOMStringBuilder.prototype.SetContents=function(n,t){this.AppendText(null,t)};n.DOMStringBuilder.prototype.SetAttribute=function(n,t,i){this.sb.Append(" "+t+'="'+i+'"')};n.DOMStringBuilder.prototype.InnerHTML=function(n,t){t&&this.AppendText(null,t)};n.DOMStringBuilder.prototype.InnerText=function(n,t){t&&this.AppendText(null,t)}}(Cheetah,document);!function(n){var t={Operators:["[","]","*","/","+","-","%","<","<=",">",">=","==","!=","!=","!","||","?",":","(",")","~","^",">>","<<",","]};n.Expression=function(i,r){var f=null,e=!0,o=i,h=r,s,u;this.ModelTokens=[];this.VarTokens=[];this.Eval=function(t,i,r){try{var u=f;return(i=ch.Coalesce(i,t.Model),e)?(r||(r={}),r.$$root=o.Model,u(o,i,r,t)):i[u]}catch(s){return s.description.indexOf("undefined or null reference")==-1&&n.Logger.Error(s.description),""}};s=new t.Compiler;u=s.Compile(r,this.ModelTokens,this.VarTokens,{$$root:1,$$result:1});u.indexOf("return")==0?f=new Function("__vm","__model","__injected","__ec",u):(f=u,e=!1)};t.Compiler=function(){this._sb=new n.StringBuilder;this._tokenType=0;this._token=""};t.Compiler.prototype.PushToken=function(n,t){t==undefined&&(t=this._tokenType>1);n==undefined&&(n=this._token);ch.IsEmpty(n)||this._sb.Append(n);this._token="";this._tokenType=0};t.Compiler.prototype.Compile=function(n,i,r,u){function s(n){return n>="0"&&n<="9"?!0:n=="."||n=="-"}function h(n,i,r,u){var f=-1;return n.ForEach(function(e){var s,o,c,h,l;(++f,e.indexOf("'")!=0&&e.indexOf('"')!=0)&&e!="NaN"&&e!="undefined"&&e!="null"&&e!="true"&&e!="false"&&isNaN(parseFloat(e))&&t.Operators.indexOf(e)==-1&&(o=e,e=="="?o=" == ":e=="and"?o=" && ":e=="or"?o=" || ":(s=e.indexOf("!")==0,s&&(e=e.substr(1)),o=e,e="",o.indexOf("this.")==0?o=o.replace("this.","__vm."):o.indexOf("ch.")==0||(o.indexOf("$$")==0?(c=o.FirstInList("."),u[c]?(e=o,o="__injected."+o):(e=o,o="__model."+o)):o.indexOf("$")==0?(h=o.TrimAfterIncluding("."),l=o.indexOf(".")!=-1?o.TrimBefore("."):"",r.push(h.substr(1)),o="__ec.GetVar('"+h.substr(1)+"')"+l):o.indexOf(".")!=0&&(e=o,o="__model."+o)),e!=""&&i.push(e),s&&(o="!"+o)),n.Replace(f,o))}),n}for(var f,o=n.length,e=0;e<o;++e)f=n[e],f=="'"?this._tokenType==2?this.PushToken(this._token+f,!0):(this.PushToken(),this._tokenType=2,this._token=String(f)):this._tokenType==2?this._token+=f:f==" "?this.PushToken():s(f)?this._tokenType==3||this._tokenType==1?this._token+=f:(this.PushToken(),this._token=String(f),this._tokenType=3):/[!=<>\|&/\*\^\+]/.test(f)?this._tokenType==4?this._token+=f:(this.PushToken(),this._token=String(f),this._tokenType=4):/[{}:;\(\)?\]\[+,]/.test(f)?(this.PushToken(),this.PushToken(f,!0)):(this._token+=String(f),this._tokenType=1);return this.PushToken(),n=h(this._sb,i,r,u).ToString(""),"return "+n+";"}}(Cheetah,document);!function(n){function t(n){return{Speed:ch.FindValue(n,"speed","fast"),Select:ch.FindValue(n,"select")}}function i(n,t,i,r){var u=null;ch.IsEmpty(i.Select)?ch.IsValid(t)?u=$(t):n&&(u=$(ch.EventTarget(n))):u=ch.SelectTarget(n,i.Select);u&&r(u)}var r=new function(){this.Name="fadein";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.fadeIn(u.Speed,f)})};n.RegisterActionStep(this)},u=new function(){this.Name="fadeout";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.fadeOut(u.Speed,f)})};n.RegisterActionStep(this)},f=new function(){this.Name="slidedown";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.slideDown(u.Speed,f)})};n.RegisterActionStep(this)},e=new function(){this.Name="slideup";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){return t(n)};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.slideUp(u.Speed,f)})};n.RegisterActionStep(this)},o=new function(){this.Name="animate";this.AllowChildren=!0;this.IsAnimation=!0;this.ProcessAttributes=function(n){var i=t(n);return i.Options={},n.ForEach(function(n){n.localName!="select"&&n.localName!="speed"&&n.localName!="if"&&(i.Options[n.localName]=n.value)}),i};this.Run=function(n,t,r,u,f){i(n,t,u,function(n){n.animate(u.Options,u.Speed,f)})};n.RegisterActionStep(this)}}(Cheetah,document);!function(n){function t(t,i,r){t.Name=i;t._storage=r;t.ProcessAttributes=function(n){return{Name:ch.FindValue(n,"name"),Value:ch.FindValue(n,"value")}};t.Run=function(n,i,r,u){t._storage.SetValue(u.Name,u.Value)};n.RegisterActionStep(t)}function i(t,i,r){t.Name=i;t._storage=r;t.AllowChildren=!0;t.ProcessAttributes=function(n){var t={Required:"none",OnlyOne:!0,Items:[]};return n.ForEach(function(n){switch(n.localName){case"name":t.Items.push({Name:n.value,Type:"string"});break;case"required":t.Required=n.value;break;default:t.OnlyOne=!1;t.Items.push({Name:n.localName.toLowerCase(),Type:n.value.toLowerCase()})}}),t};t.Run=function(n,i,r,u,f){var e=0,o=u.Required=="all"?u.Items.length:0,s=u.Required=="all"||u.Required=="none"?null:u.Required.split(",");s&&(o=s.length);n.$$result||(n.$$result={});u.Items.ForEach(function(i){var r=t._storage.GetValue(i.Name);if(r){++e;try{switch(i.Type){case"number":r=Number(r);break;case"date":r=new Date(r)}}catch(f){}u.OnlyOne?n.$$result=r:n.$$result[i.Name]=r}});f&&e>=o&&f()};n.RegisterActionStep(t)}var r=new function(){t(this,"sessionsetter",n.Session)},u=new function(){i(this,"sessiongetter",n.Session)},f=new function(){t(this,"storagesetter",n.Storage)},e=new function(){i(this,"storagegetter",n.Storage)},o=new function(){t(this,"cookiesetter",n.Cookie)},s=new function(){i(this,"cookiegetter",n.Cookie)}}(Cheetah,document);!function(n){function t(t,i,r){t.Name=i;t.Verb=r;t.AllowChildren=!0;t.SpecialChildren=["OnFail"];t.ProcessAttributes=function(n){for(var t,r={},u=n.length,i=0;i<u;++i)t=n[i],t.name!="if"&&(r[t.name]=t.value);return r};t.Run=function(i,r,u,f,e,o){var s=u.CreateService(),c=s.NormalizeUrl(f.url),h;f=ch.Clone(f);delete f.url;f.params&&typeof f.params=="object"&&(h=ch.Clone(f.params),delete f.params,f=ch.Merge(h,f));s.Query(c,t.Verb,f,function(n){i.$$result=n;e&&e()},function(t){o?(i.$$result=t,o()):n.Logger.Error(t)})};n.RegisterActionStep(t)}var i=new function(){t(this,"serviceget","GET")},r=new function(){t(this,"servicepost","POST")},u=new function(){t(this,"serviceput","PUT")},f=new function(){t(this,"servicedelete","DELETE")}}(Cheetah,document);
//# sourceMappingURL=cheetah.min.js.map
